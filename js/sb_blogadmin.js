window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["add_moderator_gforumdisplay","confirm_delete_blog_channel","delete_a_blog_channel","delete_blog","error_adding_moderator","error_deleting_blog","manage_subscribers","transfer_blog_ownership","unexpected_error","blogs","blog_title_exists"]);var blogIconEditDlg=false;(function(A){var B=[".blogadmin-widget",".summary-widget"];if(!vBulletin.pageHasSelectors(B)){return false}A(document).ready(function(){A(".blogadmin-widget select").selectBox();A(".btnBlogReset").off("click").on("click",function(L){if(A(".blogIcon .blogIconUrl").val()){A(".blogIcon .blogIconImg").attr("src",A(".blogIcon .blogIconUrl").val());A(".blogIcon .blogFileDataId").val(A(".blogIcon .initFiledataid").val())}else{A(".blogIcon .blogIconImg").addClass("hide");A(".blogIcon .blogFileDataId").val("")}var J=A(this).closest("form");var K=A('input[name="sidebarInfo"]',J).val().split(",");A.each(K,function(M,O){var P=O.split(":");var N=A('.sidebar-modules-container .widget[data-widget-instance-id="'+P[0]+'"]');if(P[1]=="hide"){N.addClass("hidden-widget");A(".module-controls .hide-control",N).attr("checked",true)}else{N.removeClass("hidden-widget");A(".module-controls .hide-control",N).attr("checked",false)}N.appendTo(".sidebar-modules-container")});return true});A(".blog-icon-controls .edit-blog-icon").off("click").on("click",function(J){J.preventDefault();A(".blogIcon .uploadBlogIcon").trigger("click")});A(".blog-icon-controls .remove-blog-icon").off("click").on("click",function(J){J.preventDefault();A(".blogIcon .blogIconImg").attr("src","").addClass("hide");A(".blogIcon .blogFileDataId").val("");A(".blogIcon .blog-icon-controls").addClass("hide");A(".blogIcon .custom-upload-button").removeClass("hide-imp")});moderatorsAutocomplete=new vBulletin_Autocomplete(A(".moderator_input"),{apiClass:"user",maxItems:1,containerClass:"blog-moderator-autocomplete"});A(document).off("click",".add_moderator").on("click",".add_moderator",function(J){J.stopPropagation();$moderatorForm=A(this).closest("form");$channelid=$moderatorForm.find(':input[name="nodeid"]').val();$recipient=moderatorsAutocomplete.getElements();$recipient=$recipient[0]["value"];A("body").css("cursor","wait");A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/node/requestChannel",type:"post",data:{channelid:$channelid,recipientname:$recipient,requestType:"moderator_to"},dataType:"json",success:function(K){if(K&&!K.errors){location.reload()}else{if(A.isArray(K.errors)&&K.errors.length>0){openAlertDialog({title:vBulletin.phrase.get("add_moderator_gforumdisplay"),message:vBulletin.phrase.get("error_x",K.errors[0][0]),iconType:"error"})}}},complete:function(){A("body").css("cursor","default")},error:function(){openAlertDialog({title:vBulletin.phrase.get("add_moderator_gforumdisplay"),message:vBulletin.phrase.get("error_adding_moderator"),iconType:"error"})}})});A(document).off("click",".btnRemoveContributor").on("click",".btnRemoveContributor",function(J){J.stopPropagation();$moderatorForm=A(this).closest("form");$channelid=$moderatorForm.find(':input[name="nodeid"]').val();$userid=A(this).attr("userid");$usergroupid=A(this).attr("usergroupid");A("body").css("cursor","wait");A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/user/unsetGroupInTopic",type:"post",data:{userid:$userid,nodeids:$channelid,usergroupid:$usergroupid},dataType:"json",success:function(K){if(K&&!K.errors){location.reload()}else{if(A.isArray(K.errors)&&K.errors.length>0){openAlertDialog({title:vBulletin.phrase.get("add_moderator_gforumdisplay"),message:vBulletin.phrase.get("error_x",K.errors[0][0]),iconType:"error"})}}},complete:function(){A("body").css("cursor","default")},error:function(){openAlertDialog({title:vBulletin.phrase.get("add_moderator_gforumdisplay"),message:vBulletin.phrase.get("error_adding_folder"),iconType:"error"})}})});A(document).off("click",".btnTransferOwnership").on("click",".btnTransferOwnership",function(M){var K=A(this).closest("form");var J=K.find(':input[name="nodeid"]').val();var L=openConfirmDialog({title:vBulletin.phrase.get("transfer_blog_ownership"),message:"Loading...",width:500,dialogClass:"transfer-ownership-dialog loading",buttonLabel:{yesLabel:vBulletin.phrase.get("send_request"),noLabel:vBulletin.phrase.get("cancel")},onClickYes:function(){if(A(".transfer-ownership-dialog .transfer_owner_select:visible").length>0){$user=A(".transfer-ownership-dialog .transfer_owner_select").val()}else{$user=A('.transfer-ownership-dialog :input[name="transfer_owner_autocomplete"]').val()}if($user.length==0){return false}A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/node/requestChannel",type:"post",data:{channelid:J,recipientname:$user,requestType:"owner_to"},dataType:"json",success:function(N){if(N&&!N.errors){location.reload()}else{if(A.isArray(N.errors)&&N.errors.length>0){openAlertDialog({title:vBulletin.phrase.get("transfer_blog_ownership"),message:vBulletin.phrase.get("error_x",vBulletin.phrase.get(N.errors[0])),iconType:"error"})}}},complete:function(){A("body").css("cursor","default")},error:function(){openAlertDialog({title:vBulletin.phrase.get("transfer_blog_ownership"),message:vBulletin.phrase.get("error_adding_folder"),iconType:"error"})}})}});A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/render/blogadmin_transferownership",data:({nodeid:J}),type:"POST",dataType:"json",success:function(N){console.log("/ajax/render/blogadmin_transferownership");if(N&&!N.errors){A(".transfer-ownership-dialog").removeClass("loading");A(".dialog-content .message",L).html(N).find("[placeholder]").placeholder();L.dialog("option","position","center");transferOwnerAutocomplete=new vBulletin_Autocomplete(A(".transfer_owner_autocomplete"),{apiClass:"user",maxItems:1});A(".transfer_ownership_tabs").tabs()}else{console.log("/ajax/render/blogadmin_transferownership successful, but response was not valid");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error",onAfterClose:function(){L.dialog("close")}})}},error:function(P,O,N){console.log("/ajax/render/blogadmin_transferownership failed, error: "+N);openAlertDialog({title:vBulletin.phrase.get("move_posts"),message:"Error loading move form. (Error code {0})<br /><br />Please try again.".format(P.status),iconType:"error",onAfterClose:function(){L.dialog("close")}})}})});var I=new vBulletin_Autocomplete(A(".moderator_members_input"),{apiClass:"user",containerClass:"blog-moderator-autocomplete"});A(".blogadmin-widget .blogAdminRight .manage_moderators_row .moderators_right #select-all").off("change").on("change",function(){var L=A(this);var K=L.is(":checked");var J=L.closest(".moderators_right").find(".subscribers-list-container");if(K){J.find(":input[type=checkbox]").prop("checked",true)}else{J.find(":input[type=checkbox]").prop("checked",false)}});A(document).off("click",".blogRemoveSubscriber").on("click",".blogRemoveSubscriber",removeSubscriber);A(document).off("click",".blogAdminSubscriberPaging .right-arrow, .blogAdminSubscriberPaging .left-arrow").on("click",".blogAdminSubscriberPaging .right-arrow, .blogAdminSubscriberPaging .left-arrow",subscriberChangePage);A(".blogAdminSubscriberPaging .right-arrow ").removeClass("disabled");A(".blogAdminSubscriberPaging .pagenav .textbox").change(subscriberChangePage);A(document).off("click",".editBlogIcon").on("click",".editBlogIcon",function(J){A(".editBlogIconDlg").dialog()});A(document).off("click",".btnBlogIconClose").on("click",".editBlogIconDlg",function(J){A(".editBlogIconDlg").dialog("close")});A(document).off("click","#btnBlogDelete").on("click","#btnBlogDelete",function(L){var J=A(this).closest("form");var K=J.find(':input[name="nodeid"]').val();openConfirmDialog({title:vBulletin.phrase.get("delete_a_blog_channel"),message:vBulletin.phrase.get("confirm_delete_blog_channel"),iconType:"warning",onClickYes:function(){A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/delete",type:"post",data:{nodeid:K},dataType:"json",success:function(M){if(M&&!M.errors){window.location.href=pageData.baseurl+"/blogs";return false}else{if(A.isArray(M.errors)&&M.errors.length>0){openAlertDialog({title:vBulletin.phrase.get("delete_blog"),message:vBulletin.phrase.get("error_x",M.errors[0][0]),iconType:"error"})}}},complete:function(){A("body").css("cursor","default")},error:function(){openAlertDialog({title:vBulletin.phrase.get("delete_blog"),message:vBulletin.phrase.get("error_deleting_blog"),iconType:"error"})}});return false},onClickNo:function(){}});return false});A(".blogIcon .uploadBlogIcon").fileupload({dropZone:null,dataType:"json",acceptFileTypes:/(gif|jpg|jpeg|jpe|png)$/i,add:function(K,J){A(".blogIcon .upload-status-bar").removeClass("hide");J.form.attr("action",A(this).data("url"));J.submit()},done:function(K,J){if(J.result&&J.result.thumbUrl){A(".blogIcon .blogIconImg").attr("src",J.result.thumbUrl).removeClass("hide");A(".blogIcon .blogFileDataId").val(J.result.filedataid);A(".blogIcon .blog-icon-controls").removeClass("hide");A(".blogIcon .custom-upload-button").addClass("hide-imp")}},fail:function(M,L){var K=vBulletin.phrase.get("error_uploading_image");var J="error";if(L&&L.files.length>0){switch(L.files[0].error){case"acceptFileTypes":K=vBulletin.phrase.get("invalid_image_allowed_filetypes_are");J="warning";break}}openAlertDialog({title:vBulletin.phrase.get("upload"),message:K,iconType:J})},always:function(){A(".blogIcon .upload-status-bar").addClass("hide")}});A(".blogAdminForm .action-buttons button[type=submit]").off("click").on("click",function(){this.form.action=pageData.baseurl+"/create-content/blog"});var C=A.cookie(pageData.cookie_prefix+"blog_title");if(C!=null){A('.blogAdminForm :input[name="title"]').val(C.replace(/\+/g," "));A.cookie(pageData.cookie_prefix+"blog_title",null,{path:pageData.baseurl_path})}var H=A.cookie(pageData.cookie_prefix+"blog_description");if(H!=null){A('.blogAdminForm :input[name="description"]').val(H.replace(/\+/g," "));A.cookie(pageData.cookie_prefix+"blog_description",null,{path:pageData.baseurl_path})}var F=A.cookie(pageData.cookie_prefix+"blogadmin_error");if(F!=null){openAlertDialog({title:vBulletin.phrase.get("blogs"),message:vBulletin.phrase.get(F),iconType:"error"});A.cookie(pageData.cookie_prefix+"blogadmin_error",null,{path:pageData.baseurl_path})}if(A(".blogAdmin-stats-table").length>0){var G=A(".blogAdmin-stats-table").data("nodeid");A(document).off("click",".showDaily").on("click",".showDaily",function(J){renderStats(G,"daily",1,".blogAdminRight")});A(document).off("click",".showMonthly").on("click",".showMonthly",function(J){renderStats(G,"monthly",1,".blogAdminRight")});vBulletin.pagination({context:".blogAdminRight",onPageChanged:function(J,K){renderStats(G,"daily",J,".blogAdminRight")}})}A(document).off("click",".editBlogIcon").on("click",".editBlogIcon",function(J){if(!blogIconEditDlg){blogIconEditDlg=A(J.target).closest(".blogSummaryContainer").find(".sgIconUploader").dialog({width:600,autoOpen:false})}A(blogIconEditDlg).dialog("open");return false});A(document).off("click",".btnSGIconCancel").on("click",".btnSGIconCancel",function(J){A(J.target).closest(".sgIconUploader").dialog("close")});A(document).off("click",".btnSGIconUrlSubmit").on("click",".btnSGIconUrlSubmit",uploadIconFromUrl);A(document).off("click",".sgRadioIconFile").on("click",".sgRadioIconFile",function(J){A(J.target).closest(".sgIconUploader ").find(".sgIconFileChooser").removeClass("hide");A(J.target).closest(".sgIconUploader ").find(".sgIconUrlInput ").addClass("hide")});A(document).off("click",".sgRadioIconUrl").on("click",".sgRadioIconUrl",function(J){A(J.target).closest(".sgIconUploader ").find(".sgIconFileChooser").addClass("hide");A(J.target).closest(".sgIconUploader ").find(".sgIconUrlInput ").removeClass("hide")});var E=A(".blogIconImg");var D=vBulletin.getAjaxBaseurl()+"/uploader/"+(E.length>0?"uploadSGIcon":"upload_file");A(".uploadSgIcon").fileupload({formData:function(J){return[{name:"nodeid",value:J.data("nodeid")}]},url:D,add:function(K,J){J.submit()},done:function(K,J){if(J){if(J.result.errors){if(typeof (J.result.errors[0])=="undefined"){openAlertDialog({title:vBulletin.phrase.get("blog_icon"),message:vBulletin.phrase.get(J.result.errors),iconType:"error"})}else{openAlertDialog({title:vBulletin.phrase.get("blog_icon"),message:vBulletin.phrase.get(J.result.errors[0]),iconType:"error"})}}else{if(J.result.imageUrl){if(E.length>0){A(".blogIconImg").attr("src",J.result.imageUrl);A(blogIconEditDlg).dialog("close")}else{A(".sgIconPreview").html('<img src="'+J.result.imageUrl+'" alt="">');A(".sGIconfiledataid").val(J.result.filedataid);A(sgIconUploadDlg).dialog("close")}}else{openAlertDialog({title:vBulletin.phrase.get("blog_icon"),message:vBulletin.phrase.get("unable_to_upload_file"),iconType:"error"})}}}else{openAlertDialog({title:vBulletin.phrase.get("blog_icon"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},fail:function(M,K){var L=vBulletin.phrase.get("error_uploading_image");var J="error";if(K&&K.files.length>0){switch(K.files[0].error){case"acceptFileTypes":L=vBulletin.phrase.get("invalid_image_allowed_filetypes_are");J="warning";break;case"maxFileSize":L=vBulletin.phrase.get("image_exceeded_max_file_size","100 KB");J="warning";break}}openAlertDialog({title:vBulletin.phrase.get("upload"),message:L,iconType:J,onAfterClose:function(){$editProfilePhotoDlg.find(".fileText").val("");$editProfilePhotoDlg.find(".browse-option").focus()}})}});A(".sidebar-modules-container").trigger("reset").sortable({revert:true,tolerance:"pointer",placeholder:"widget module-drag-highlight",handle:false,items:".widget",cursor:"move",axis:"y"}).disableSelection();A(".sidebar-modules-container .module-controls .hide-control").off("click").on("click",function(){A(this).closest(".widget")[this.checked?"addClass":"removeClass"]("hidden-widget")});A("form.sidebarForm").off("submit.sidebar").on("submit.sidebar",function(){var J=[];A(".sidebar-modules-container .widget").each(function(){J.push(A(this).attr("data-widget-instance-id")+":"+(A(".module-controls .hide-control",A(this)).prop("checked")?"hide":"show"))});A('input[name="sidebarInfo"]',(this)).val(J.join())})})})(jQuery);removeSubscriber=function(B){var A=$(B.target).closest(".manage_moderators_row");userid=$(B.target).attr("data-userid");groupid=$(B.target).attr("data-groupid");nodeid=$(B.target).attr("data-nodeid");if(userid&&(userid>0)&&groupid&&(groupid>0)&&nodeid&&(nodeid>0)){$.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/user/unsetgroupintopic",type:"post",data:{userid:userid,nodeids:nodeid,usergroupid:groupid},dataType:"json",success:function(C){if(C&&!C.errors){A.remove()}else{if($.isArray(C.errors)&&C.errors.length>0){openAlertDialog({title:vBulletin.phrase.get("manage_subscribers"),message:vBulletin.phrase.get("error_x",C.errors[0][0]),iconType:"error"})}}},complete:function(){$("body").css("cursor","default")},error:function(){openAlertDialog({title:vBulletin.phrase.get("manage_subscribers"),message:vBulletin.phrase.get("error_adding_folder"),iconType:"error"})}})}};var pageno=1;subscriberChangePage=function(B){pageCount=parseInt($(B.target).closest(".blogAdminSubscriberPaging").attr("data-pagecount"));if($(B.target).hasClass("left-arrow")||$(B.target).parent().hasClass("left-arrow")){var A=pageno-1;if(A<1){$(B.target).addClass("disabled");return }}else{if($(B.target).hasClass("right-arrow")||$(B.target).parent().hasClass("right-arrow")){var A=pageno+1;if(A>pageCount){$(B.target).addClass("disabled");return }}else{if($(B.target).hasClass("textbox")){var A=parseInt($(B.target).val());if(isNaN(A)||(A>pageCount)||(A<1)){$(B.target).val(this.pageno);return }}else{return }}}url=vBulletin.getAjaxBaseurl()+"/ajax/render/blogadmin_subscriberlist?pageno="+A+"&nodeid="+$(B.target).closest(".blogAdminEditPage").attr("data-nodeid");$.ajax({url:url,type:"post",dataType:"json",success:function(C){$(B.target).closest(".blogAdminEditPage").find(".subscriberList").html(C);if(A>=pageCount){$(B.target).closest(".blogAdminEditPage").find(".right-arrow").addClass("disabled")}else{$(B.target).closest(".blogAdminEditPage").find(".right-arrow").removeClass("disabled")}if(A<=1){$(B.target).closest(".blogAdminEditPage").find(".left-arrow").addClass("disabled")}else{$(B.target).closest(".blogAdminEditPage").find(".left-arrow").removeClass("disabled")}$(B.target).closest(".blogAdminEditPage").find(".pagenav .textbox").val(A);pageno=A;$(".blogRemoveSubscriber").off("click").on("click",removeSubscriber)}})};uploadIconFromUrl=function(C){var B=$(".blogIconImg");var A=vBulletin.getAjaxBaseurl()+"/uploader/"+(B.length>0?"uploadSGIcon":"url");vBulletin.AJAX({url:A,error_phrase:"upload_errors",data:{nodeid:$(C.target).closest(".sgicon-upload-form").data("nodeid"),url:$(C.target).parent(".sgIconUrlInput").find("#imgUrl").val()},success:function(D){if(B.length>0){$(".blogIconImg").attr("src",D.imageUrl);$(blogIconEditDlg).dialog("close")}else{$(".sgIconPreview").html('<img src="'+D.imageUrl+'" alt="">');$(".sGIconfiledataid").val(D.filedataid);$(blogIconEditDlg).dialog("close")}}})};function renderStats(B,A,C,D){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/widget_blogstats?nodeid="+B+"&interval="+A+"&page="+C,success:function(E){$(D).html(E)}})};