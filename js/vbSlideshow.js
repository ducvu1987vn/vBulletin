window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["gallery_slideshow","no_photos_found_or_post_deleted"]);(function(A){window.vBulletin=window.vBulletin||{};vBulletin.gallery=vBulletin.gallery||{};A(document).ready(function(){var F=5,B=A("#slideshow-dialog"),G=0;A(document).off("click",".galleryLink").on("click",".galleryLink",function(){var M=A(this);if(M.closest("#preview-overlay").length==1){return false}var H=M.attr("data-channelid"),K=M.closest(".photoPreviewBox"),J=M.attr("src");G=(K.length>0)?K.index():M.index();A(document).off("click","#slideshow-dialog .close-btn").on("click","#slideshow-dialog .close-btn",function(){B.dialog("close")});A(document).off("click",".thumbnails .image-wrapper").on("click",".thumbnails .image-wrapper",function(P,O){if(typeof O=="undefined"){O=true}A(".thumbnails .image-wrapper",B).addClass("dimmed");A(this).removeClass("dimmed");var N=Number(A(this).parent().attr("jcarouselindex"));B.data("thumbclick",true);vBulletin.gallery.slideshow.jcarousel("scroll",N,O);B.removeData("thumbclick")});B.dialog({autoOpen:false,resizable:false,closeOnEscape:true,showTitleBar:false,modal:true,width:550,height:510,dialogClass:"slideshow-dialog",open:function(){A(".ui-widget-overlay").bind("click",function(){B.dialog("close")})},close:function(O,N){if(vBulletin.gallery.thumbnails){vBulletin.gallery.thumbnails.jcarousel("destroy")}if(vBulletin.gallery.slideshow){vBulletin.gallery.slideshow.jcarousel("destroy")}}});var I=B.find(".slideshow-wrapper .slideshow-list");if(I.length==0){I=B.find(".slideshow-wrapper").append(A("<ul />").addClass("slideshow-list"))}B.dialog("open");window.vBulletin.loadingIndicator.show();var L=M.closest(".list-item").attr("data-node-id")||M.closest(".list-item").attr("data-nodeid");vBulletin.gallery.slideshow=I.jcarousel({wrap:null,animation:"slow",easing:"swing",scroll:1,rtl:A("html").attr("dir")=="rtl",initCallback:function(S,R){if(R=="init"){var P=M.closest(".gallery-submit-form").find(".hiddendata input");if(P.length>0){var U={photos:[]};P.filter('[name="filedataid[]"]').each(function(){var V={title:JShtmlEncode(P.filter('[name="title_'+this.value+'"]').val()),url:pageData.baseurl+"/filedata/fetch?filedataid="+this.value,thumb:pageData.baseurl+"/filedata/fetch?thumb=1&filedataid="+this.value};U.photos.push(V)});setTimeout(function(){E(U,S)},10)}else{var Q={nodeid:L};if(vBulletin.media&&vBulletin.media.MEDIA_USERID){Q.userid=vBulletin.media.MEDIA_USERID}if(H){Q.channelid=H}var N=parseInt(A(".albumSlideShowPageNo").val());if(!isNaN(N)){Q.pageno=N}var O=parseInt(A(".albumSlideShowPerPage").val());if(!isNaN(O)){Q.perpage=O}var T=A(".media-tab .media-filter-overlay .filter-options input:checked").val();if(T){Q.dateFilter=T}if(!isNaN(G)){Q.startIndex=G}A.get(vBulletin.getAjaxBaseurl()+"/filedata/gallery",Q,function(V){if(!V&&J){V={photos:[{title:"",url:J,thumb:""}],}}E(V,S)},"json").complete(function(){window.vBulletin.loadingIndicator.hide()})}}},itemVisibleInCallback:{onBeforeAnimation:function(R,P,O,Q){if(Q=="init"){return false}var S=B.data("image-data");if(S){if(O>0){while(O>S.photos.length){O-=S.photos.length}}else{while(O<=0){O+=S.photos.length}}if(S.photos[O-1].links){B.find(".caption").html(S.photos[O-1].title+S.photos[O-1].links)}else{B.find(".caption").html(S.photos[O-1].title)}if(!B.data("thumbclick")){var N=vBulletin.gallery.thumbnails.data("visible-range")||{first:1,last:F};if(O<N.first||O>N.last){vBulletin.gallery.thumbnails.jcarousel("scroll",O,true)}A("#slideshow-dialog .thumbnails .image-wrapper").addClass("dimmed");vBulletin.gallery.thumbnails.jcarousel("get",O).find(".image-wrapper").removeClass("dimmed")}}}}});return false});function E(K,J){if(!K||!K.photos){openAlertDialog({title:vBulletin.phrase.get("gallery_slideshow"),message:vBulletin.phrase.get("no_photos_found_or_post_deleted"),iconType:"warning"});return }B.data("image-data",K);D(J,K,B);if(K.photos[0].links){B.find(".caption").html(K.photos[0].title+K.photos[0].links)}else{B.find(".caption").html(K.photos[0].title)}if(K.photos.length>1){vBulletin.gallery.thumbnails.jcarousel("get",1).find(".image-wrapper").removeClass("dimmed")}var I=G;var H=parseInt(A(".albumSlideShowPerPage").val());if(!isNaN(H)){I=G%H}if(I>0){A(".thumbnails .image-wrapper",B).eq(I).trigger("click",[false])}window.vBulletin.loadingIndicator.hide()}function D(I,K,H){I.size(K.photos.length);if(K.photos.length>1){A("#slideshow-dialog .thumbnails").show();C(K)}else{A("#slideshow-dialog .thumbnails").hide();H.dialog("option","height",444)}var J=I.first||1;A.each(K.photos,function(M,L){I.add(J+M,'<div class="image-wrapper"><img src="{0}" alt="{1}" class="image" /></div>'.format(L.url,L.title))})}function C(I){var H=A("#slideshow-dialog .thumbnails .thumbnail-list");if(H.length==0){H=A("#slideshow-dialog .thumbnails").append(A("<ul />").addClass("thumbnail-list"))}vBulletin.gallery.thumbnails=H.jcarousel({wrap:null,animation:"fast",easing:"swing",scroll:F,rtl:A("html").attr("dir")=="rtl",size:I.photos.length,initCallback:function(K,J){if(J=="init"){K.size(I.photos.length);A.each(I.photos,function(N,M){var L=(K.first||1)+N;if(K.has(L)){return true}if(L>I.photos.length){return false}var O=A("<img />").addClass("thumbnail").on("load",function(){}).attr({src:M.thumb,alt:""}).appendTo(A("<div />").addClass("image-wrapper dimmed"));K.add(L,O.parent().get(0))});if(K.size()<F){K.buttonNext.hide();K.buttonPrev.hide()}}},itemVisibleInCallback:{onBeforeAnimation:function(M,K,J,L){A("#slideshow-dialog .thumbnails").data("visible-range",{first:M.first,last:M.last})}}}).disableSelection()}})})(jQuery);