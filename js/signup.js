(function(A){window.vBulletin=window.vBulletin||{};var B=[".registration-widget"];if(!vBulletin.pageHasSelectors(B)){return false}window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=A.merge(window.vBulletin.options.precache,["usecoppa","checkcoppa","webmasteremail","reqbirthday"]);window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=A.merge(window.vBulletin.phrase.precache,["close","email_addresses_must_match","error","invalid_email_address","password_must_be_at_least_four_chars","passwords_must_match","please_enter_a_username","please_enter_your_email_address","please_enter_your_parent_or_guardians_email_address","please_select_a_day","please_select_a_month","please_select_a_year","register_not_agreed","registration_coppa_fail","registration_start_failed","site_terms_and_rules","site_terms_and_rules_title","registeremail","moderateuser","registration_complete"]);A(document).ready(function(){var K=parseInt(window.vBulletin.options.get("usecoppa")),F=false,E=false,I=false,D=parseInt(window.vBulletin.options.get("reqbirthday"));function J(){A("#frmRegister").trigger("reset");if(K||D){var R=A.cookie(pageData.cookie_prefix+"coppaage");var O,M,N,Q=false;if(K&&R&&parseInt(window.vBulletin.options.get("checkcoppa"))){var P=R.split("-",3);if(P.length==3){O=parseInt(P[0]);M=parseInt(P[1]);N=parseInt(P[2]);if(O!=0&&M!=0&&N!=0){Q=true;A("#regMonth").val(O);A("#regDay").val(M);A("#regYear").val(N)}G(O,M,N,Q,true)}}else{A(".signup-content").removeClass("hide")}A("#regMonth, #regDay, #regYear").off("change").on("change",function(){O=A("#regMonth").val();M=A("#regDay").val();N=A("#regYear").val();G(O,M,N,Q)});A(".registration-widget select").selectBox()}else{A(".signup-content").removeClass("hide")}A("#regDataUsername").off("keydown blur").on("keydown",function(S){if(S.keyCode==13){A(this).triggerHandler("blur")}return true}).on("blur",function(){if(A.trim(this.value)==""){return true}E=true;var S=this;A.ajax({url:vBulletin.getAjaxBaseurl()+"/registration/checkusername",data:{username:A.trim(S.value)},dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(T){if(T&&T.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(T.errors[0]),iconType:"warning",onAfterClose:function(){S.value="";S.select();S.focus()}})}else{if(I){A("#frmRegister").submit()}}},complete:function(){E=false}})});A("#viewTerms").off("click").on("click",function(){console.log(window.vBulletin.options.get("webmasteremail"));openAlertDialog({title:vBulletin.phrase.get("site_terms_and_rules_title"),message:vBulletin.phrase.get("site_terms_and_rules",window.vBulletin.options.get("webmasteremail"),pageData.baseurl),buttonLabel:vBulletin.phrase.get("close"),width:600,maxHeight:400});return false})}function G(P,M,O,Q,N){N=N||false;if(P!=0&&M!=0&&O!=0){if(Q){A(".birth-date-wrapper").addClass("hide")}A.ajax({url:vBulletin.getAjaxBaseurl()+"/registration/iscoppa",data:{month:P,day:M,year:O},dataType:"json",success:function(R){if(R&&typeof (R.needcoppa)!="undefined"){F=R.needcoppa!=0;if(R.needcoppa==2){if(!Q){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("registration_coppa_fail"),iconType:"error"});A(".birth-date-wrapper").addClass("hide")}A(".signup-content").addClass("hide");A(".coppafail_notice").removeClass("hide");return }else{if((R.needcoppa==1)||(!N)){A(".birth-date-wrapper").addClass("hide");A("#regContent").removeClass("hide");A("#frmRegister .action-buttons").removeClass("hide");A(".signup-content").removeClass("hide")}else{A(".birth-date-wrapper").removeClass("hide");A(".signup-content").removeClass("hide");A(".registration-widget select").selectBox()}}}A(".coppa")[F?"removeClass":"addClass"]("hide-imp")},error:function(){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("registration_start_failed"),iconType:"error"})}})}}J();function H(M,N){if(M){openAlertDialog({title:vBulletin.phrase.get("error"),message:M,iconType:"warning",onAfterClose:function(){N.focus()}});return false}return true}function L(){var M="",N;if(K){if(A("#regMonth").val()==0){M=vBulletin.phrase.get("please_select_a_month");N=A("#regMonth").next(".selectBox")}else{if(A("#regDay").val()==0){M=vBulletin.phrase.get("please_select_a_day");N=A("#regDay").next(".selectBox")}else{if(A("#regYear").val()==0){M=vBulletin.phrase.get("please_select_a_year");N=A("#regYear").next(".selectBox")}}}if(!H(M,N)){return false}}if(A.trim(A("#regDataUsername").val())==""){M=vBulletin.phrase.get("please_enter_a_username");N=A("#regDataUsername")}else{if(A.trim(A("#regDataEmail").val())==""){M=vBulletin.phrase.get("please_enter_your_email_address");N=A("#regDataEmail")}else{if(!isValidEmailAddress(A("#regDataEmail").val())){M=vBulletin.phrase.get("invalid_email_address");N=A("#regDataEmail")}else{if(A("#regDataEmail").val()!=A("#regDataEmailConfirm").val()){M=vBulletin.phrase.get("email_addresses_must_match");N=A("#regDataEmailConfirm")}else{if(F){if(A.trim(A("#parentGuardianEmail").val())==""){M=vBulletin.phrase.get("please_enter_your_parent_or_guardians_email_address");N=A("#parentGuardianEmail")}else{if(!isValidEmailAddress(A("#parentGuardianEmail").val())){M=vBulletin.phrase.get("invalid_email_address");N=A("#parentGuardianEmail")}}}}}}}if(!H(M,N)){return false}if(A("#regDataPassword").val()==""||A("#regDataPassword").val().length<4){M=vBulletin.phrase.get("password_must_be_at_least_four_chars");N=A("#regDataPassword")}else{if(A("#regDataPassword").val()!=A("#regDataConfirmpassword").val()){M=vBulletin.phrase.get("passwords_must_match");N=A("#regDataConfirmpassword")}else{if(!A("#cbApproveTerms").is(":checked")){M=vBulletin.phrase.get("register_not_agreed");N=A("#cbApproveTerms")}}}return H(M,N)}function C(){var M=this;if(!L()){I=false;return false}A(".action-buttons button",M).prop("disabled",true);A.ajax({url:vBulletin.getAjaxBaseurl()+"/registration/registration",data:A(M).serializeArray(),type:"POST",dataType:"json",success:function(O){if(O&&O.response&&O.response.errors){var Q=[];for(var N in O.response.errors){if(O.response.errors[N][0]!="exception_trace"){Q.push(vBulletin.phrase.get(O.response.errors[N]))}}openAlertDialog({title:vBulletin.phrase.get("error"),message:Q.join("<br />"),iconType:"warning",onAfterClose:function(){vBulletin.hv.reset(true)}})}else{if(O&&O.response&&O.response.usecoppa){location.replace(O.response.urlPath)}else{if(O&&O.response){var P=O.response.msg_params;P.unshift(O.response.msg);openAlertDialog({title:vBulletin.phrase.get("registration_gregister"),message:vBulletin.phrase.get.apply(vBulletin.phrase,P),onAfterClose:function(){if(O.response.urlPath){location.replace(O.response.urlPath)}else{A(".signup-success").removeClass("hide");A(".signup-content").addClass("hide")}}})}}}},error:function(N){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("registration_start_failed"),iconType:"error"})},complete:function(){A(".action-buttons button",M).prop("disabled",false);I=false}})}A("#frmRegister").off("submit.usersignup").on("submit.usersignup",function(){I=true;var M=this;setTimeout(function(){if(E){I=false;return }C.apply(M)},10);return false});A("#regBtnReset").off("click").on("click",function(M){vBulletin.hv.reset();setTimeout(function(){A(".registration-widget select").selectBox("refresh");A("#regMonth").next(".selectBox").focus()},50)})})})(jQuery);