window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["action","active","ad_list_description","add_modules","add_subforum","adding_multiple_modules_not_allowed","all","applying_new_template","are_you_sure_want_to_delete_ad_x","cancel","cannot_add_system_module","cannot_convert_channel","cannot_remove_system_module","check_to_hide_module","choose_base_module","choose_options_site_logo","click_text_edit_title","confirm_deletion_x","create_new_custom_module","delete","display_order","do_you_want_to_cancel_editing_search_module","do_you_want_to_exit_without_saving_page","do_you_want_to_remove_channel","do_you_want_to_remove_forum","do_you_want_to_remove_module","dropping_container_module_into_container_module_not_allowed","drag_and_drop_module_here","drop_page_here","edit","edit_blog_categories","edit_custom_html_module","edit_locationx_ad","edit_navigation_item","edit_search_module","edit_site_logo","error_adding_widgets","error_cloning_widget","error_deleting_page","error_fetching_channels","error_loading_search_config_script","error_processing_site_logo","error_processing_site_logo_image_hosting","error_renaming_module_title","error_retrieving_cloned_widget_template","error_retrieving_configuration","error_retrieving_list_user_groups","error_retrieving_modules","error_retrieving_navigation_bar_configuration","error_retrieving_page_map","error_retrieving_templates","error_saving_forums","error_saving_forums_code","error_saving_configuration_module","error_saving_navigation_bar_configuration","error_saving_page","error_saving_search_config","error_saving_search_config_code","error_saving_site_logo","error_saving_site_logo_code","error_uploading_logo","exit_without_saving_page","expand","input_navigation_item_name","input_target_url","invalid_image_url","main_navigation_bar","make_category","make_forum","module_configuration","module_icon","move_not_allowed","moving_main_nav_to_own_sub_nav_error","moving_main_nav_with_sub_nav_error","my_custom_modules","new_navigation_item","new_subnavigation_item","next","no_ad_added","no_configurations_found","no_modules","no_permission","none","overwrite_template_continue","page_template_title_cannot_be_empty","page_title_cannot_be_empty","please_choose_overwrite_template_options","please_enter_channel_title","please_enter_new_module_title","please_enter_new_template_name","please_enter_page_name","previous","remove_channel","remove_channel_q","remove_forum","remove_forum_q","remove_module_q","rename","rename_custom_module","reset","save","save_new_page","save_page","search_results","select_edit_link_header","sub_navigation_bar","subchannels_will_be_deleted","switch_template","template_changes_will_be_lost","title","forum_changes_will_be_lost","this_url_is_already_used","unable_to_delete_widget_instances","uncheck_to_unhide_module","url_too_long","user_group_settings","warning_gcpuser","you_are_here","you_must_specify_a_screen_layout","you_can_also_drag_and_drop_modules_here"]);(function(F){var D,C,E,B=[];function A(){var N=F("#edit-page-dropdown .panel .panel-main-content:visible");if(N.length>0){var O=parseFloat(N.css("margin-left"))+parseFloat(N.css("margin-right"))+parseFloat(N.css("border-left-width"))+parseFloat(N.css("border-right-width"))+parseFloat(N.css("padding-left"))+parseFloat(N.css("padding-right"));F("#edit-page-dropdown .panel .panel-main-content").width(F("#edit-page-dropdown .panel:visible").width()-F("#edit-page-dropdown .panel .panel-header-text:visible").outerWidth(true)-O-1);F("#edit-page-dropdown form .form-gutter-right").width(Math.ceil((F("#edit-page-dropdown form:visible").width()-F("#edit-page-dropdown .panel:visible").outerWidth(true))/2));if(B.length){var L=B[D.tabs("option","selected")];if(L){L.tinyscrollbar_update();var M=F("#edit-content > .tabs > .ui-tabs-panel:not(.ui-tabs-hide)");var H=M.find("input:checked").closest(".list-item");if(H.length>0&&!M.find(".scrollbar").hasClass("disable")){var G=H.offset().left;var K=M.find(".scroller");var P=K.offset().left+parseInt(H.css("margin-left"),10);var I=G-P;var J=M.find(".overview").width()-K.width();if(I>J){I=J}L.tinyscrollbar_update(I)}}}}}F(document).ready(function(){var u,k,i,s=[],AC,j,l=false,Y=false,I={},T=false,d=false,W=false,e=false,X=false,U=false,x=false,n=false,z={},Q={};function t(){bindFormReset("#edit-page-dropdown form").trigger("reset",function(){F("#save-content .template-name").addClass("hide");F("input[type=hidden]",this).each(function(){this.value=this.defaultValue})});function AF(){if(!F(this).hasClass("selected")&&!F(document.body).hasClass("edit-mode")){F("#main-navbar .main-nav a").removeClass("selected").closest("li").addClass("disabled");F(this).addClass("selected").closest("li").removeClass("disabled");F(document.body).addClass("edit-mode "+this.id).removeClass("view-mode");F("#main-navbar ul.secondary-nav").addClass("disabled")}return false}F(document).on("focus click mousedown","#main-navbar li.disabled a, #main-navbar ul.secondary-nav.disabled li, #main-navbar ul.secondary-nav.disabled li a",function(AJ){this.blur();AJ.stopPropagation();return false});F(document).on("click","#sitebuilder-wrapper .lnkExitWithoutSaving",function(){if(F(this).closest("#edit-page-dropdown").length==0){F("#main-navbar ul.secondary-nav").removeClass("disabled")}});var AG=F("#main-navbar li.sb-menu:not(.disabled)");F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkEditPage",function(){var AJ=this;if(F("#edit-page-dropdown-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",AJ,function(){AF.apply(AJ);var AL=[];F(".hidden-widget-placeholder").each(function(){AL.push(F(this).attr("data-widget-instance-id"))});function AK(){n=false;b();AB(false,".container-widget");F(".edit-mode .canvas-widget-list .canvas-widget").addClass("shadow");D.tabs("select",0);F("#header, #header-axd, #save-content").hide();F("#edit-content").show();F("#edit-page-dropdown .lnkSaveChanges .label").text(vBulletin.phrase.get("save_page"));F("#edit-page-dropdown-gutter").removeClass("hide").slideDown("slow",V);F(".canvas-widget.axd-widget .widget-content").each(function(){F(this).html(AH(F(this).html(),vBulletin.phrase.get("ad")))})}if(AL.length==0){AK()}else{F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-hidden-modules",data:({modules:AL}),type:"POST",dataType:"json",complete:function(){console.log("fetch-hidden-modules complete.");AK()},success:function(AM){console.log("fetch-hidden-modules successful! result:"+JSON.stringify(AM));if(F.isArray(AM)){if(AM.length>0){F.each(AM,function(AN,AP){var AO=F(AP.template).addClass("hidden-widget");F('.hidden-widget-placeholder[data-widget-instance-id="'+AP.widgetinstanceid+'"]').replaceWith(AO)})}}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AO,AN,AM){console.log("fetch-hidden-modules failed! error:"+AM);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",AO.status),iconType:"error"})}})}})}return false});F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkNewPage",function(){var AJ=this;if(F("#edit-page-dropdown-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",AJ,function(){AF.apply(AJ);n=true;F(".canvas-widget-list").empty();D.tabs("select",0);F("#change-layout .layout-border.selected").removeClass("selected");F("#layout-70-30").prev().trigger("click");l=false;F("#header, #header-axd, #save-content").hide();F("#edit-content").show();F("#edit-page-dropdown .lnkSaveChanges .label").text(vBulletin.phrase.get("save_new_page"));F("#edit-page-dropdown-gutter").removeClass("hide").slideDown("slow",V)})}return false});var AI=false;F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkHeader",function(){var AJ=this;if(F("#admin-navbar-strip-gutter").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",AJ,function(){AF.apply(AJ);AI=false;F("#admin-navbar-strip-gutter").addClass("navbar-header").removeClass("hide").find(".prompt-text").text(vBulletin.phrase.get("select_edit_link_header"));var AK=F("#header"),AL=F(".header-cell",AK);$siteLogoEditStrip=F("> .admin-only",AL).addClass("hide-imp"),w=AL.outerWidth();F(".disable-overlay",AK).width(AK.innerWidth()-w).height(AK.innerHeight()).show();$siteLogoEditStrip.width(w-(parseInt($siteLogoEditStrip.css("padding-left"),10)+parseInt($siteLogoEditStrip.css("padding-right"),10))).removeClass("hide-imp")})}return false});function AH(AL,AK){var AJ=F("<div />").append(AL.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,'<span class="axd-placeholder">{0}'.format(vBulletin.phrase.get("x_will_show_up_here_when_saved",AK))).replace(/<vb\:/g,"&lt;vb:").replace(/<\/vb\:/g,"&lt;/vb:"));AJ.find("span.axd-placeholder").not(":first").remove();AJ.find("iframe").remove();return AJ.html()}F(document).on("focus click mousedown",".edit-mode.lnkHeader #header .site-logo > a",function(AJ){this.blur();AJ.stopPropagation();return false});(function(){var AM=null;var AK=null;var AZ=null;var Aa="";var AW="";var AU="";var AP="";var AY=function(Ab){if(!Ab){return false}if(Ab.match(/^https?:\/\//i)){return Ab}if(Ab.substr(0,1)=="/"){return pageData.baseurl+Ab}return pageData.baseurl+"/"+Ab};var AL=function(Ag,Ac,Ad,Af,Ab){Ab=Ab||[];console.log("createNavbarItem... Name: "+Ac+" Url: "+Ad+" NewWindow: "+Af+" UserGroups: "+Ab);Ac=JShtmlEncode(Ac);var Ae=F("<li />").append("<label>{0}</label>".format(Ac)).append(F("<div />").addClass("nav-item-controls right").append('<i>|</i><span class="navbar-item-delete" title="{0}"></span>'.format(vBulletin.phrase.get("delete"))).append('<i>|</i><span class="navbar-item-edit" title="{0}"></span>'.format(vBulletin.phrase.get("edit"))).append('<i>|</i><span class="navbar-item-opensubnav" title="{0}"></span>'.format(vBulletin.phrase.get("expand")))).data({"item-phrase":Ag,"item-name":Ac,"item-url":Ad,"item-newwindow":Af,"item-usergroups":Ab});return Ae};var AO=function(Ab){return Ab.prevAll("li").size()};var AS=function(Ad,Af,Ag){return ;if(Af=="add"){var Ai=Ad.data("item-newwindow")?' target="_blank"':"";F("#channel-tabbar ul").append("<li><a"+Ai+' href="'+AY(Ad.data("item-url"))+'">'+Ad.data("item-name")+"</a></li>")}else{if(Af=="update"){var Ai=Ad.data("item-newwindow")?' target="_blank"':"";var Aj=AO(Ad);var Ae=F("#channel-tabbar ul li");Ae.eq(Aj).replaceWith("<li><a"+Ai+' href="'+AY(Ad.data("item-url"))+'">'+Ad.data("item-name")+"</a></li>")}else{if(Af=="remove"){var Aj=AO(Ad);var Ae=F("#channel-tabbar ul li");Ae.eq(Aj).remove()}else{if(Af=="move"){var Ae=F("#channel-tabbar ul li");var Ab=Ae.eq(Ag.from);Ab.remove();if(Ag.to>0){var Ah=(Ag.to>Ag.from)?(Ag.to):(Ag.to-1);var Ac=Ae.eq(Ah);Ab.insertAfter(Ac)}else{Ab.prependTo("#channel-tabbar ul")}}}}}};var AV=function(){console.log("generateNavbarDisplay");var Ab=(AP=="navbar")?F("#channel-tabbar ul"):F("#footer-tabbar ul.nav-list");var Ac=(AP=="navbar")?F("#channel-subtabbar ul"):F();Ab.html("");Ac.html("");F("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var Ae=F(this);var Ad=Ae.data("item-newwindow")?' target="_blank"':"";var Af=Ae.hasClass("selected")&&AP!="footer"?' class="current"':"";Ab.append('<li{0}><a href="{1}"{2}>{3}</a></li>'.format(Af,AY(Ae.data("item-url")),Ad,Ae.data("item-name")));if(Ae.hasClass("selected")){console.log(Ae.data("subnav-element"));F(Ae.data("subnav-element")).find("li").each(function(){var Ah=F(this);console.log(Ah.data("item-url"));var Ag=Ah.data("item-newwindow")?' target="_blank"':"";var Ai=Ah.hasClass("selected")?' class="current"':"";Ac.append('<li{0}><a href="{1}"{2}>{3}</a></li>'.format(Ai,AY(Ah.data("item-url")),Ag,Ah.data("item-name")))})}})};var AN=function(Ai,Ae,Ag,Ah,Ab,Ad){var Ac=AL(Ai,Ae,Ag,Ah,Ab);console.log("insertNavbarItem... Name: "+Ac.data("item-name")+" Url: "+Ac.data("item-url")+" NewWindow: "+Ac.data("item-newwindow")+" UserGroups: "+Ac.data("item-usergroups"));Ac.appendTo(AK);AS(Ac,"add");var Af=F("<ul />").addClass("sub-navbar-list navbar-list sortable");F(Ad).each(function(){var Ao=this.phrase?this.phrase:"",Ak=this.title?this.title:"",Am=this.url?this.url:"",An=this.newWindow?this.newWindow:false,Aj=this.usergroups?this.usergroups:[];var Al=AL(Ao,Ak,Am,An,Aj);Al.appendTo(Af)});(function(){var Aj=null;Af.sortable({start:function(Ak,Al){Al.placeholder.html(vBulletin.phrase.get("drop_page_here")).height(Al.item.height()-2)},stop:function(Ak,Al){AV()},receive:function(Ak,Al){var Am=Al.item.data("subnav-element")||F();if(Am.is(":visible")){Al.sender.sortable("cancel");openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("moving_main_nav_to_own_sub_nav_error"),iconType:"warning"})}else{if(Am.find("li").length>0){Al.sender.sortable("cancel");openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("moving_main_nav_with_sub_nav_error"),iconType:"warning"})}}},connectWith:".sortable",placeholder:"sortable-highlight",forcePlaceholderSize:true}).disableSelection()})();Af.hide();Af.appendTo("#navbar-ui-container .subnavbar-list-container");Ac.data("subnav-element",Af);AV()};var AR=function(Ac,Ad,Ae,Af,Ab){$newItem=AL(Ac.data("item-phrase"),Ad,Ae,Af,Ab);console.log("updateNavbarItem... Name: "+$newItem.data("item-name")+" Url: "+$newItem.data("item-url")+" NewWindow: "+$newItem.data("item-newwindow")+" UserGroups: "+$newItem.data("item-usergroups"));if(Ac.data("subnav-element")){$newItem.data("subnav-element",Ac.data("subnav-element"))}if(Ac.hasClass("selected")){$newItem.addClass("selected")}Ac.replaceWith($newItem);AV()};var AX=function(Ab){AP=Ab;if(AP=="navbar"){Aa=F("#channel-tabbar ul").html();AW=F("#channel-subtabbar ul").html();AU=F("#channel-tabbar ul li.current a").attr("href");F("#channel-subtabbar.hide").toggleClass("hide default-hide")}else{Aa=F("#footer-tabbar ul.nav-list").html();AU=F("#footer-tabbar ul.nav-list li.current a").attr("href")}F("#admin-navbar-strip-gutter").removeClass().addClass("navbar-"+AP);F("#header").add("#header-axd").hide();F("#edit-navbar #navbar-ui-container .navbar-ui-wrapper").remove();F("#edit-navbar #navbar-ui-container .subnavbar-ui-wrapper").remove();F("#edit-navbar .panel-header-text").hide();F("#edit-navbar #panel-header-"+AP).show();F("#edit-navbar").slideDown("slow",function(){window.vBulletin.loadingIndicator.show();F("body").css("cursor","wait");var Ac=(AP=="navbar")?"loadHeaderNavbar":"loadFooterNavbar";F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/site/"+Ac,data:({siteId:1,edit:1}),type:"POST",dataType:"json",complete:function(){window.vBulletin.loadingIndicator.hide();F("body").css("cursor","auto")},success:function(Ad){console.log(Ac+" successful! result:"+JSON.stringify(Ad));var Ag=F("<ul />").addClass("main-navbar-list navbar-list sortable "+AP);var Af=F("<div />").addClass("new-nav-item main-nav").html(vBulletin.phrase.get("new_navigation_item"));var Ae=F("<h4 />").text(vBulletin.phrase.get("footer"));F("<div />").addClass("navbar-ui-wrapper").append(Ae).append(Ag).append(Af).appendTo("#navbar-ui-container");var Aj=null;Ag.sortable({start:function(Al,Am){Am.placeholder.html(vBulletin.phrase.get("drop_page_here")).height(Am.item.height()-2)},stop:function(Al,Am){AV()},connectWith:".sortable",placeholder:"sortable-highlight",forcePlaceholderSize:true}).disableSelection();AK=Ag;var Ak=F("<div />").addClass("subnavbar-list-container");var Ai=F("<div />").addClass("new-nav-item sub-nav").html(vBulletin.phrase.get("new_subnavigation_item"));var Ah=F("<h4 />").text(vBulletin.phrase.get("sub_navigation_bar"));F("<div />").addClass("subnavbar-ui-wrapper").append(Ah).append(Ak).append(Ai).appendTo("#navbar-ui-container").hide();if(Ad){console.log("result:",Ad);F(Ad).each(function(){var Aq=this.phrase?this.phrase:"",Am=this.title?this.title:"",Ao=this.url?this.url:"",Ap=this.newWindow?true:false,Al=this.usergroups?this.usergroups:[],An=this.subnav?this.subnav:[];AN(Aq,Am,Ao,Ap,Al,An)});console.log("Done adding items")}F("#edit-navbar .navbar-ui-wrapper ul li").first().find(".navbar-item-opensubnav").filter(":visible").click()},error:function(Af,Ae,Ad){console.log(Ac+" failed! error:"+Ad);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_navigation_bar_configuration"),iconType:"error",onAfterClose:function(){F("#config-dialog").dialog("close")}});F("#config-dialog .loader").hide()}})})};F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkNavBar",function(){var Ab=this;if(F("#edit-navbar").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ab,function(){AF.apply(Ab);AX("navbar")})}return false});F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkFooter",function(){var Ab=this;if(F("#edit-navbar").is(":hidden")){vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ab,function(){AF.apply(Ab);AX("footer")})}return false});F(document).on("click","#main-navbar .sb-menu:not(.disabled) #lnkPageManager",function(){var Ab=this;vBulletin.assertUserHasAdminPermission("canusesitebuilder",Ab,function(){AF.apply(Ab);AB(false);F(".edit-mode .canvas-widget-list .canvas-widget").addClass("shadow");F("#header, #header-axd, #save-content").hide();F("#manage-page").show();F("#manage-page-dropdown .lnkSaveChanges .label").text(vBulletin.phrase.get("save_page"));F("#manage-page-dropdown").removeClass("hide").slideDown("slow",L)});return false});var AJ=function(Ab){F("#navbar-edit-item").dialog({autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:400,dialogClass:"dialog-container navbar-item-dialog-container",open:function(){F("#navbar-edit-name").focus()}}).dialog("option","title",Ab||vBulletin.phrase.get("edit_navigation_item")).dialog("open")};F("#edit-navbar").on("click",".new-nav-item",function(){AM=null;if(F(this).closest(".navbar-ui-wrapper").size()>0){AK=F(this).closest(".navbar-ui-wrapper").find("ul")}else{AK=F(this).closest(".subnavbar-ui-wrapper").find("ul").filter(":visible")}F("#navbar-edit-name").val("");F("#navbar-edit-url").val("");F("#navbar-edit-newwindow").prop("checked",false);AJ(F(this).html());return false});F(document).on("click","#navbar-edit-save",function(){if(F("#navbar-edit-name").val()==""){openAlertDialog({title:vBulletin.phrase.get("edit_navigation_item"),message:vBulletin.phrase.get("input_navigation_item_name"),iconType:"warning",onAfterClose:function(){F("#navbar-edit-name").focus()}})}else{if(F("#navbar-edit-url").val()==""){openAlertDialog({title:vBulletin.phrase.get("edit_navigation_item"),message:vBulletin.phrase.get("input_target_url"),iconType:"warning",onAfterClose:function(){F("#navbar-edit-url").focus()}})}else{console.log("Saving new/edited navbar item");if(!AM){AN("",F("#navbar-edit-name").val(),F("#navbar-edit-url").val(),F("#navbar-edit-newwindow").prop("checked"),F("#navbar-edit-item").data("edit-usergroups"),[])}else{AR(AM,F("#navbar-edit-name").val(),F("#navbar-edit-url").val(),F("#navbar-edit-newwindow").prop("checked"),F("#navbar-edit-item").data("edit-usergroups"))}AM=null;AK=null;F("#navbar-edit-item").dialog("close");console.log("Done saving new/edited navbar item")}}return false});F(document).on("click","#navbar-edit-cancel",function(){F("#navbar-edit-item").dialog("close");return false});var AQ=false;F(document).on("click","#navbar-edit-usergroups",function(){var Ac=function(){F("#navbar-edit-usergroups-dialog .dialog-body input[type=checkbox]").prop("checked",false);var Af=F("#navbar-edit-usergroups-dialog .select_all");var Ad=function(){if(F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox:checked").length==F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox").length&&F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox").eq(0).is(":checked")){Af.prop("checked",true)}else{Af.prop("checked",false)}};F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox").off("change").on("change",Ad);Af.off("change").on("change",function(){if(F(this).prop("checked")){F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox").prop("checked",true)}else{F("#navbar-edit-usergroups-dialog .navbar-usergroup-checkbox").prop("checked",false)}});if(!AM){return false}console.log("Prefilling checked usergroups");console.log(AM.data("item-name"));console.log(AM.data("item-url"));console.log(AM.data("item-usergroups"));if(AM.data("item-usergroups-temp")){var Ae=AM.data("item-usergroups-temp")}else{var Ae=AM.data("item-usergroups")}console.log(Ae);F.each(Ae,function(Ag,Ah){F("#navbar-edit-usergroups-dialog .dialog-body #navbar-usergroup-checkbox-"+Ah).prop("checked",true)});Ad()};var Ab=function(){var Ad=[];F("#navbar-edit-usergroups-dialog .dialog-body input[type=checkbox]").each(function(){if(F(this).prop("checked")){Ad.push(F(this).val())}});F("#navbar-edit-item").data("edit-usergroups",Ad);if(AM){AM.data("item-usergroups-temp",Ad)}console.log("Saving checked usergroups")};if(!AQ){F("#navbar-edit-usergroups-dialog").dialog({title:vBulletin.phrase.get("user_group_settings"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:500,dialogClass:"dialog-container pagemap-dialog-container input-dialog",create:function(){F("#navbar-edit-usergroups-dialog .cancel-button").on("click",function(){F("#navbar-edit-usergroups-dialog").dialog("close")});F("#navbar-edit-usergroups-dialog .save-button").on("click",function(){Ab();F("#navbar-edit-usergroups-dialog").dialog("close")});F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/usergroup/fetchUsergroupList",data:({siteId:1}),type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(Ad){console.log("fetchUsergroupList successful! result:"+JSON.stringify(Ad));if(Ad){console.log("result:",Ad);var Ae=[];F(Ad).each(function(){Ae.push('<div class="blockrow"><label><input type="checkbox" class="navbar-usergroup-checkbox" id="navbar-usergroup-checkbox-{0}" value="{0}"><span>{1}</span></label></div>'.format(this.usergroupid,this.title))});F("#navbar-edit-usergroups-dialog .dialog-body").html(Ae.join(""));F("#navbar-edit-usergroups-dialog").dialog("option","position","center");console.log("Done adding usergroups")}Ac()},error:function(Af,Ae,Ad){console.log("fetchUsergroupList failed! error:"+Ad);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_list_user_groups"),iconType:"error",onAfterClose:function(){F("#config-dialog").dialog("close")}});F("#config-dialog .loader").hide()}})},close:function(){},open:function(){Ac()}});AQ=true}else{F("#navbar-edit-usergroups-dialog").dialog("open")}return false});F("#edit-navbar").on("click",".navbar-item-delete",function(){AS(F(this).closest("li"),"remove");F(this).closest("li").remove();AV();return false});F("#edit-navbar").on("click",".navbar-item-edit",function(){var Ab=F(this).closest("li");console.log("Click to edit item... Name: "+Ab.data("item-name")+" Url: "+Ab.data("item-url")+" NewWindow: "+Ab.data("item-newwindow")+" UserGroups: "+Ab.data("item-usergroups"));AM=Ab;AK=Ab.closest("ul");AM.data("item-usergroups-temp",null);F("#navbar-edit-name").val(Ab.data("item-name"));F("#navbar-edit-url").val(Ab.data("item-url"));F("#navbar-edit-newwindow").prop("checked",Ab.data("item-newwindow"));AJ(F(this).html());return false});F("#edit-navbar").on("click",".navbar-item-opensubnav",function(){var Ab=F(this).closest("li");console.log("Click to open item subnav ... Name: "+Ab.data("item-name")+" Url: "+Ab.data("item-url")+" NewWindow: "+Ab.data("item-newwindow")+" UserGroups: "+Ab.data("item-usergroups"));F("#edit-navbar li").removeClass("disabled selected");Ab.addClass("selected");F("#edit-navbar .subnavbar-ui-wrapper ul").hide();F(Ab.data("subnav-element")).show();F("#edit-navbar .subnavbar-ui-wrapper").show();AV();return false});F(document).on("click",".navbar-navbar #admin-navbar-strip .lnkExitWithoutSaving, .navbar-footer #admin-navbar-strip .lnkExitWithoutSaving",function(){F("#edit-navbar").slideUp();F("#header").add("#header-axd").show();if(AP=="navbar"){F("#channel-tabbar ul").html(Aa);F("#channel-subtabbar ul").html(AW).parent(".default-hide").toggleClass("hide default-hide")}else{F("#footer-tabbar ul.nav-list").html(Aa)}});var AT=function(){var Ab=[];F("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var Ae=F(this);var Ad=[];Ae.data("subnav-element").find("li").each(function(){$subLi=F(this);Ad.push({phrase:$subLi.data("item-phrase"),title:$subLi.data("item-name"),url:$subLi.data("item-url"),newWindow:$subLi.data("item-newwindow"),usergroups:$subLi.data("item-usergroups")})});Ab.push({phrase:Ae.data("item-phrase"),title:Ae.data("item-name"),url:Ae.data("item-url"),newWindow:Ae.data("item-newwindow"),usergroups:Ae.data("item-usergroups"),subnav:Ad})});var Ac=(AP=="navbar")?"saveHeaderNavbar":"saveFooterNavbar";F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/site/"+Ac,data:({siteId:1,data:Ab}),type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(Ae){if(Ae.errors){console.log(Ac+" failed! error:"+JSON.stringify(Ae));openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_navigation_bar_configuration"),iconType:"error"});return }console.log(Ac+" successful! result:"+JSON.stringify(Ae));F("#edit-navbar").slideUp();F("#header").add("#header-axd").show();F("#main-navbar ul.main-nav li").removeClass("disabled").find("a").removeClass("selected");F("#admin-navbar-strip-gutter").addClass("hide");F(document.body).removeClass("edit-mode lnkEditPage lnkNewPage lnkHeader lnkNavBar lnkFooter").addClass("view-mode");F("#main-navbar ul.secondary-nav").removeClass("disabled");if(AP=="navbar"){var Ad=false;F("#edit-navbar .navbar-ui-wrapper ul li").each(function(){var Af=F(this);if(AY(Af.data("item-url"))==AU){Ad=true;F("#edit-navbar .navbar-ui-wrapper ul li").removeClass("selected");Af.addClass("selected");return false}});if(Ad){AV()}else{F("#channel-tabbar ul li").removeClass("current");F("#channel-subtabbar ul").html("")}}else{F("#footer-tabbar ul.nav-list li").removeClass("current");F("#footer-tabbar ul.nav-list li").filter(function(){var Af=F(this).find("a").attr("href");return(Af==AU)}).addClass("current")}},error:function(Af,Ae,Ad){console.log(Ac+" failed! error:"+Ad);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_navigation_bar_configuration"),iconType:"error",onAfterClose:function(){F("#config-dialog").dialog("close")}});F("#config-dialog .loader").hide()}})};F(document).on("click",".navbar-navbar #admin-navbar-strip .lnkSaveChanges",function(){AT()});F(document).on("click",".navbar-footer #admin-navbar-strip .lnkSaveChanges",function(){AT()})})();F("#main-navbar .main-nav").removeClass("hide");F(document).on("click","#admin-navbar-strip .lnkSaveChanges",function(){});F(document).on("click",".lnkHeader #admin-navbar-strip .lnkSaveChanges",function(){F("body").css("cursor","wait");if(Number(F("#header .site-logo img").attr("data-fileid"))>0){var AJ=AI?function(){location.reload(true)}:null;K(AJ)}else{if(AI){location.reload(true)}else{F("body").css("cursor","auto");F("#main-navbar li").removeClass("disabled").find("a").removeClass("selected");F("#admin-navbar-strip-gutter").addClass("hide").find(".prompt-text").text("");F(document.body).removeClass("edit-mode lnkHeader").addClass("view-mode");F("#header .disable-overlay").hide();F("#main-navbar ul.secondary-nav").removeClass("disabled")}}});F(document).on("click",".lnkHeader #admin-navbar-strip .lnkExitWithoutSaving",function(AK){if(AI){AK.stopImmediatePropagation();location.reload(true);return false}else{var AJ=F("#header .site-logo img");if(AJ.attr("src")!=AJ.attr("data-orig-src")){AJ.attr("src",AJ.attr("data-orig-src")).removeAttr("data-fileid")}F("#admin-navbar-strip-gutter").find(".prompt-text").text("");F("#header .disable-overlay").hide()}});F(document).on("click","#admin-navbar-strip .lnkExitWithoutSaving",function(){F("#main-navbar li").removeClass("disabled").find("a").removeClass("selected");F("#admin-navbar-strip-gutter").addClass("hide");F(document.body).removeClass("edit-mode lnkEditPage lnkNewPage lnkHeader lnkNavBar lnkFooter").addClass("view-mode");F("#header").add("#header-axd").show();F("#edit-navbar").hide()});F("#header-axd .axdnum").change(function(){var AJ=F(this),AK=parseInt(AJ.val());window.vBulletin.loadingIndicator.show();F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/ad/saveNumberOfHeaderAds",type:"post",data:{number:AK},dataType:"json",success:function(AL){if(AL!==null&&typeof AL.errors!=="undefined"){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AL.errors[0]),iconType:"error"})}else{if(AK==1){F("#header-axd").removeClass("axdnum_2").addClass("axdnum_1")}else{F("#header-axd").removeClass("axdnum_1").addClass("axdnum_2")}}},complete:function(){window.vBulletin.loadingIndicator.hide()}})});F(document).off("click",".axd-edit-button").on("click",".axd-edit-button",function(){var AJ=F(this).attr("data-location"),AO=F(this).closest(".axd-container");if(AO.length==0){AO=F('.axd-container[data-widget-instance-id="'+AJ+'"]')}AN();function AN(AP){AP=AP||false;F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/ad/listAdsByLocation",type:"post",data:{adlocation:AJ},dataType:"json",cache:false,success:function(AQ){if(AQ!==null&&typeof AQ.errors!=="undefined"){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AQ.errors[0]),iconType:"error"})}else{if(AQ){AK(AQ)}else{if(!AP){AL({adlocation:AJ})}else{AK([])}}}},complete:function(){F("body").css("cursor","default")}})}function AK(AP){if(typeof z.axd_list_dialog=="undefined"){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/dialog_axd_list",success:function(AQ){z.axd_list_dialog=AQ;F("body").append(AQ);AK(AP)},error_phrase:"error_fetching_dialog"});return }F("#axd-list-dialog").dialog({title:vBulletin.phrase.get("edit_locationx_ad",AJ),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:600,dialogClass:"dialog-container ad-list-dialog-container input-dialog",open:function(){var AQ=F(this);var AS=[];for(var AR in AP){AS.push([AP[AR].title,AP[AR].active,AP[AR].displayorder,AP[AR].adid])}F(".title",AQ).text(vBulletin.phrase.get("ad_list_description",AJ));F(".axdtable",AQ).dataTable({bPaginate:false,bLengthChange:false,bInfo:false,bAutoWidth:false,bDestroy:true,aaSorting:[[2,"asc"]],aoColumns:[{sTitle:vBulletin.phrase.get("title")+"<span></span>",sClass:"axdtable-title axd-cell"},{sTitle:vBulletin.phrase.get("active"),sClass:"axdtable-active axd-cell",bSortable:false,bSearchable:false,fnRender:function(AU,AT){return'<input type="checkbox" class="isactive" data-id="{0}"{1} />'.format(AU.aData[3],((AT=="1")?' checked="checked"':""))}},{sTitle:vBulletin.phrase.get("display_order")+"<span></span>",sClass:"axdtable-display-order axd-cell",bSearchable:false,bUseRendered:false,fnRender:function(AU,AT){return'<input type="text" class="displayorder textbox" value="{0}" data-id="{1}" />'.format(AU.aData[2],AU.aData[3])}},{sTitle:vBulletin.phrase.get("action"),sClass:"axdtable-action axd-cell",bSearchable:false,bSortable:false,bUseRendered:false,fnRender:function(AU,AT){return'<a href="#" class="editlink" data-id="{0}" title="{1}"><span></span></a> <a href="#" class="deletelink" data-id="{0}" title="{2}"><span></span></a>'.format(AU.aData[3],vBulletin.phrase.get("edit"),vBulletin.phrase.get("delete"))}}],aaData:AS});F(".dataTables_filter input[type=text]",AQ).addClass("axdfilter textbox").on("keyup",function(){F(this).next()[this.value!=""?"removeClass":"addClass"]("hide")}).after('<button type="button" class="axdSearchBtn button secondary hide">{0}</button>'.format(vBulletin.phrase.get("reset")));F(".axdSearchBtn",AQ).on("click",function(){F(this).addClass("hide").prev().val("").trigger("keyup")});F(".axdtable .editlink",AQ).off("click").on("click",function(){var AT=F(this).attr("data-id");AQ.dialog("close");AQ.dialog("destroy");AL(AP[AT]);return false});F(".axdtable .deletelink",AQ).off("click").on("click",function(){var AT=F(this).attr("data-id"),AU=F(this).closest("tr").find(".isactive").prop("checked");AQ.dialog("close");AQ.dialog("destroy");openConfirmDialog({title:vBulletin.phrase.get("confirm_deletion_x",AP[AT].title),message:vBulletin.phrase.get("are_you_sure_want_to_delete_ad_x",AP[AT].title,"adid",AT),iconType:"warning",onClickYes:function(){F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/ad/delete",type:"post",data:{adid:AT},dataType:"json",success:function(AV){if(AV.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AV.errors[0]),iconType:"error"})}else{AN(true);if(AU){AI=true}}}})},onClickNo:function(){AN()}});return false});F(".axdlist",AQ).show();F(".btnAddAxd",AQ).off("click").on("click",function(){AQ.dialog("close");AQ.dialog("destroy");AL({adlocation:AJ});return false});F(".btnCancelAxd",AQ).off("click").on("click",function(){AQ.dialog("close");AQ.dialog("destroy")});F(".btnSaveAxd",AQ).off("click").on("click",function(){if(F(".isactive",AQ).length==0){AQ.dialog("close");AQ.dialog("destroy");return false}F("body").css("cursor","wait");var AT={},AU=[];F(".isactive",AQ).each(function(){var AV=F(this).attr("data-id");AT[AV]={};AT[AV]["displayorder"]=F('.displayorder[data-id="'+AV+'"]',AQ).val();if(F(this).is(":checked")){AT[AV]["active"]=1;var AW=AT[AV];AW.snippet=AP[AV].snippet;AW.title=AP[AV].title;AU.push(AW)}else{AT[AV]["active"]=0}});F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/ad/quickSave",type:"post",data:{data:AT},dataType:"json",success:function(AV){if(AV.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AV.errors[0]),iconType:"error"})}else{var AW=F(".axd_"+AJ,AO);if(AW.length==0){AW=F(".widget-content",AO)}if(AU.length>0){AU.sort(function(Aa,AZ){return Aa.displayorder-AZ.displayorder});var AY="",AX="";F.map(AU,function(Aa,AZ){if(Aa.snippet){AX+=AH(Aa.snippet,Aa.title);AY+=Aa.snippet}});AW.html(AX);AI=AM(AY)}else{AW.html("")}AW.show();AQ.dialog("close");AQ.dialog("destroy");F("html,body").animate({scrollTop:0},"slow")}},complete:function(){F("body").css("cursor","default")}})})}})}function AL(AQ){var AP=AQ.adlocation;if(typeof z.axd_config_dialog=="undefined"){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/dialog_axd_config",success:function(AR){z.axd_config_dialog=AR;F("body").append(AR);AL(AQ)},error_phrase:"error_fetching_dialog"});return }F("#axd-config-dialog").dialog({title:vBulletin.phrase.get("edit_locationx_ad",AP),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:720,dialogClass:"dialog-container axd-dialog-container input-dialog",open:function(){var AR=F(this);if(AQ.adid){F(".title",AR).val(AQ.title);F(".axd_html",AR).val(AQ.snippet);if(AQ.active=="1"){F(".active",AR).prop("checked",true)}else{F(".active",AR).prop("checked",false)}F(".axdid",AR).val(AQ.adid);for(var AS in AQ.criterias){F("[name=data\\[criteria\\]\\["+AQ.criterias[AS].criteriaid+"\\]\\[active\\]]",AR).prop("checked",true);F("[name=data\\[criteria\\]\\["+AQ.criterias[AS].criteriaid+"\\]\\[condition1\\]]",AR).val(AQ.criterias[AS].condition1);F("[name=data\\[criteria\\]\\["+AQ.criterias[AS].criteriaid+"\\]\\[condition2\\]]",AR).val(AQ.criterias[AS].condition2);F("[name=data\\[criteria\\]\\["+AQ.criterias[AS].criteriaid+"\\]\\[condition3\\]]",AR).val(AQ.criterias[AS].condition3)}}else{F(".axdid",AR).val(0);F(".configform",AR).trigger("reset")}F(".axd_location",AR).val(AP);F(".blockrow select.custom-dropdown",AR).selectBox();F(".blockrow a.custom-dropdown, .blockrow input[type=text]",AR).on("click",function(AU){return false});F(".btnAttachHtmlAxd",AR).off("click").on("click",function(){var AU=F(".configform",AR).serialize();F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/ad/save",type:"post",data:AU,dataType:"json",success:function(AV){if(AV){if(AV.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AV.errors[0]),iconType:"error"})}else{AT();AI=AM(F(".configform .axd_html",AR).val())}}},complete:function(){F("body").css("cursor","default")}})});F(".btnCancelEditHtmlAxd",AR).off("click").on("click",function(){AT(true)});function AT(AU){AU=AU||false;F(":checkbox",AR).prop("checked",false);F("select",AR).val("");AR.dialog("close");AR.dialog("destory");AN(AU)}}})}function AM(AR){var AQ=F("<div>"+AR+"</div>");if(AQ.filter("script").length>0){return true}else{var AP=AQ.find("*").filter(function(){return(this.nodeName.toLowerCase().indexOf("vb:")==0)?this:null});return(AP.length>0||(/\{vb\s*\:\s*[a-z]+\s+.*\}/).test(AR))}}return false});F("#header .header-cell .edit.button").on("click",function(){F(".header-edit-box.selected").removeClass("selected");F(this).closest(".header-edit-box").addClass("selected");F("#edit-site-logo-dialog").dialog({title:vBulletin.phrase.get("edit_site_logo")+'<span class="dialog-subtitle">'+vBulletin.phrase.get("choose_options_site_logo")+"</span>",autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:520,dialogClass:"dialog-container site-logo-dialog-container input-dialog",create:function(){F("#btnCancelEditSiteLogo").on("click",function(){F("#edit-site-logo-dialog").dialog("close")});F("#btnSaveEditSiteLogo").on("click",function(){if(Number(F("#header .site-logo img").attr("data-fileid"))>0){K(function(){F("#edit-site-logo-dialog").dialog("close")})}else{F("#edit-site-logo-dialog").dialog("close")}});F("#edit-site-logo-dialog .styleselection").change(function(){F("#header .site-logo img").attr({"data-styleselection":F(this).val()})});F("#edit-site-logo-dialog").fileupload({dropZone:null,add:function(AK,AJ){F("body").css("cursor","wait");F(AK.target).find(".upload-progress-bar:first").removeClass("hide");AJ.submit()},done:function(AK,AJ){if(AJ.result&&AJ.result.filedataid){F("#header .site-logo img").attr({src:AJ.result.imageUrl,"data-fileid":AJ.result.filedataid,"data-styleselection":F("#edit-site-logo-dialog .styleselection:checked").val()})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})}},fail:function(AK,AJ){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_uploading_logo"),iconType:"error"})},always:function(AK,AJ){F("body").css("cursor","auto");F(AK.target).find(".upload-progress-bar:first").addClass("hide")}});F("#edit-site-logo-dialog #btnAttachLogo").on("click",function(){var AJ=F.trim(F("#edit-site-logo-dialog #imageUrl").val());if(AJ){F("body").css("cursor","wait");F(this).closest(".dialog-content").find(".upload-progress-bar:last").removeClass("hide");F.ajax({url:vBulletin.getAjaxBaseurl()+"/uploader/Url",data:({urlupload:AJ}),type:"POST",dataType:"json",complete:function(){console.log("uploader/url complete.");F("body").css("cursor","auto");F("#edit-site-logo-dialog .upload-progress-bar:last").addClass("hide")},success:function(AK){console.log("saving site logo successful! result:"+AK);if(AK&&!AK.error){F("#header .site-logo img").attr({src:AK.imageUrl,"data-fileid":AK.filedataid,"data-styleselection":F("#edit-site-logo-dialog .styleselection:checked").val()})}else{if(AK.error){openAlertDialog({title:vBulletin.phrase.get("edit_site_logo"),message:vBulletin.phrase.get("invalid_image_url"),iconType:"warning",onAfterClose:function(){F("#edit-site-logo-dialog #imageUrl").select().focus()}})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_processing_site_logo"),iconType:"error",onAfterClose:function(){F("#edit-site-logo-dialog #imageUrl").focus()}})}}},error:function(AM,AL,AK){console.log("remote url site logo failed! error:"+AK);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_processing_site_logo_image_hosting",AM.status),iconType:"error",onAfterClose:function(){F("#edit-site-logo-dialog #imageUrl").focus()}})}})}else{F("#edit-site-logo-dialog #imageUrl").focus()}})}})});F(".admin-button-flat").disableSelection();D=F("#edit-content .tabs").tabs({show:function(AJ,AK){S(AK.index);A()},select:function(AK,AL){F("#save-content").hide();if(AL.index==1){if(e){F("#edit-page-dropdown .layout-list .layout-border.selected").removeClass("selected");var AJ=F("#edit-page-dropdown .layout-list input[type=radio][value={0}]".format(F(".canvas-layout:visible").attr("data-layout-id")));AJ.prev().addClass("selected");u="canvas-"+AJ.attr("id")}}}});F("#lnkAddModules").on("click",function(){D.tabs("select",0);return false});y();F(document).on("click",".module-buttons .hide-icon input",function(){var AK=F(this);AK.closest(".canvas-widget")[this.checked?"addClass":"removeClass"]("hidden-widget");var AJ=AK.attr("title");AK.attr("title",AK.data("toggle-title")).data("toggle-title",AJ)});F(".canvas-layout-container .canvas-layout").each(function(){s[this.id]=F("#"+this.id+' div[class*="section-"]').length});if(!n){u="canvas-"+F("#edit-page-dropdown .layout-list input[type=radio][value={0}]".format(F(".canvas-layout:visible").attr("data-layout-id"))).prop("checked",true).attr("id")}k=F("#edit-page-dropdown .layout-list input[type=radio]").thumbnailRadioCheckbox({thumbnailClass:"layout-border"});k.thumbnailRadioCheckbox("option","select",function(AK,AJ){F(".canvas-layout").addClass("hide");F("#canvas-"+AJ.attr("id")).removeClass("hide");g("canvas-"+AJ.attr("id"));c();AD();l=true});(function(){F(".lnkPageMap").on("click",function(){F("#page-map-dialog").dialog({title:vBulletin.phrase.get("page_map"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:500,dialogClass:"dialog-container pagemap-dialog-container input-dialog",create:function(){F("#btnClosePageMapDialog").on("click",function(){F("#page-map-dialog").dialog("close")});F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/page/fetchPageMapHierarchy",data:({pageId:pageData.pageid}),type:"POST",dataType:"json",complete:function(){console.log("/ajax/api/page/fetchPageMapHierarchy complete");F("body").css("cursor","auto")},success:function(AU){console.log("/ajax/api/page/fetchPageMapHierarchy successful");if(AU&&F.isArray(AU.pageMap)){var AP,AO,AM="",AQ,AS,AT,AL,AJ,AK,AN,AR;for(AP=0;AP<AU.pageMap.length;++AP){AQ=AU.pageMap[AP].page;AS=AU.pageMap[AP].siblings;AM+="<ul>";for(AO=0;AO<AS.length;++AO){AT=AS[AO];AJ=(AT.pageid==AQ.pageid)?' class="current-path"':"";AJ=(AT.pageid==AQ.pageid&&((AP+1)==AU.pageMap.length))?' class="current-path-end"':AJ;AL=((AP+1)==AU.pageMap.length)?"":"<span>&gt;</span>";AK=(AT.pageid==AQ.pageid&&((AP+1)==AU.pageMap.length))?'<div id="you-are-here" class="round-corner7"><div class="arrow"><div class="arrow-inner"></div></div>'+vBulletin.phrase.get("you_are_here")+"</div>":"";AM+="<li"+AJ+">"+AL+'<a href="'+pageData.baseurl+AT.url+'">'+vBulletin.htmlEntities(AT.title)+"</a>"+AK+"</li>"}AM+="</ul>"}F("#page-map-content").html(AM);AN=F("#you-are-here").parent().outerWidth()+10;F("#you-are-here").css({left:AN,top:-10})}else{console.log(AU);console.log("/ajax/api/page/fetchPageMapHierarchy successful, but response was not an array");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AL,AK,AJ){console.log("/ajax/api/page/fetchPageMapHierarchy failed, error: "+AJ);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_page_map",AL.status),iconType:"error"})}})},close:function(){}});F("#page-map-dialog").dialog("open");return false})})()}function g(AH){if(!u){F(".canvas-layout.hide input[type=hidden]").prop("disabled",true);F("#"+AH+" input[type=hidden]").prop("disabled",false);u=AH;return }else{if(u==AH){return }else{F(".canvas-layout.hide input[type=hidden]").prop("disabled",true);F("#"+AH+" input[type=hidden]").prop("disabled",false);var AF=s[AH];var AI=false;var AG=0;F("#"+u+" > .canvas-layout-row > div.canvas-widget-list").each(function(){AG=a(this);AI=F("#"+AH+" > .canvas-layout-row > div.section-"+AG);if(!AI.length){var AJ=AF;while(AJ>=0&&F("#"+AH+" > .canvas-layout-row > div.section-"+AJ).length==0){AJ--}AI=F("#"+AH+" > .canvas-layout-row > div.section-"+AJ)}F(this).children("div.canvas-widget").appendTo(AI)})}}u=AH}function a(AH){var AG=/section-(\d+)/gi;var AF=null;F(F(AH).attr("class").split(" ")).each(function(AJ,AK){var AI=AG.exec(AK);if(AI&&!isNaN(AI[1])){AF=AI[1]}});return AF}function H(AF){if(!F.isArray(AF)||AF.length==0){return }window.vBulletin.loadingIndicator.show();F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/admin-template/widget",data:({widgets:AF,pagetemplateid:F("#save-page-form #pagetemplateid-yes").val()}),type:"POST",dataType:"json",complete:function(){console.log("admin-template/widget complete. moduleLoaded="+d);if(d){window.vBulletin.loadingIndicator.hide()}F("body").css("cursor","auto")},success:function(AG){console.log("admin-template/widget successful! result:"+JSON.stringify(AG));W=true;if(AG&&F.isArray(AG.widgets)){F.each(AG.widgets,function(AH,AJ){if(!AJ.widgetid||Number(AJ.widgetid)<1||!F.trim(AJ.template)){return true}var AK=(AJ.displaysection&&Number(AJ.displaysection)>0)?AJ.displaysection:0;var AI=F(AJ.template);AI.appendTo(F(".canvas-layout:not(.hide) .canvas-widget-list.section-"+AK).height("auto")).filter(":not(.container-widget)").find(".toggle-button").trigger("click",[true]);AI.find(".tabs").tabs()})}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AI,AH,AG){console.log("admin-template/widget failed! error:"+AG);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_adding_widgets",AI.status),iconType:"error"})}});return false}function v(AF,AG){if(AF.text()=="<"){AF.text(">");AF.closest(".channel-item-container").children(".sub-channel-container").children(".channel-item-container").slideDown(150)}else{if(typeof (AG)==="undefined"||!AG){AF.text("<");AF.closest(".channel-item-container").children(".sub-channel-container").children(".channel-item-container").slideUp(150)}}}function Z(){F(".channel-config-dialog .channel-list").sortable({placeholder:"main-channel-container-highlight drag-highlight clear",update:function(AF,AG){AG.item.css("z-index","0");I.forum=true;Y=true},sort:function(AF,AG){},start:function(AF,AG){if(F.browser.msie&&parseInt(F.browser.version,10)==8){AG.item.height(AG.item.height()-4)}AG.item.css("z-index","99999");AG.placeholder.height(AG.item.outerHeight())},over:function(AF,AG){},receive:function(AF,AG){},out:function(AF,AG){},handle:".grip-icon-main",items:".main-channel-container"})}function r(AF){AC=AF.find(".main-channel-container").sortable({connectWith:".sub-channel-container",placeholder:"channel-item-highlight drag-highlight",revert:true,update:function(AG,AH){var AI=AH.item.closest(".main-channel-container");if(AH.sender&&AH.sender.hasClass("main-channel-container")){if(F("> .channel-item-container",AH.sender).length==0){AH.sender.slideUp("fast",function(){F(this).remove()})}}I.forum=true;Y=true},sort:function(AG,AH){},activate:function(AG,AH){},start:function(AG,AH){},stop:function(AG,AH){F(".main-channel-container, .sub-channel-container").height("auto")},over:function(AG,AH){},receive:function(AG,AH){},out:function(AG,AH){},handle:".channel-item-inner > .grip-icon-item",items:".channel-item-container"})}function J(AF){j=AF.find(".sub-channel-container").sortable({connectWith:".sub-channel-container",revert:true,placeholder:"channel-item-highlight drag-highlight",update:function(AG,AH){if(AH.sender&&AH.sender.hasClass("main-channel-container")){if(F("> .channel-item-container",AH.sender).length==0){AH.sender.slideUp("fast",function(){F(this).remove()})}}I.forum=true;Y=true},sort:function(AG,AH){},start:function(AG,AH){},stop:function(AG,AH){F(".main-channel-container, .sub-channel-container").height("auto")},over:function(AH,AI){var AG=F(this).closest(".channel-item-container").children(".channel-item").find(".toggle-button");v(AG,true)},receive:function(AG,AH){},out:function(AG,AH){},handle:".channel-item-inner > .grip-icon-item",items:".channel-item-container"})}function AE(AF,AI,AJ,AK,AN,AP,AM){var AL='<div class="'+(AN?"category-to-channel":"channel-to-category")+'"><a href="#">'+vBulletin.phrase.get((AN?"make_forum":"make_category"))+"</a></div>";var AO=F(('<div class="main-channel-container">					<div class="grip-icon grip-icon-main {0}"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>					<div class="channel-item-container">						<div class="channel-item shadow" data-channel-id="{1}" data-parent-id="{4}">							<div class="channel-item-inner">								<div class="grip-icon grip-icon-item {0}"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>								<div class="channel-title"><div title="'+vBulletin.phrase.get("click_text_edit_title")+'">{2}</div><input type="text" name="channeltitle" value="{2}" /></div>								<div class="close-button" title="'+vBulletin.phrase.get("remove_forum")+'">x</div>							   <div class="toggle-button"><</div>							   <div class="num-subchannels">'+AM+'</div>							   <div class="add-subchannel-button {3}" title="'+vBulletin.phrase.get("add_subforum")+'"><a href="#">+</a></div>							   '+AL+'								<div class="clear"></div>							</div>						</div>						<div class="sub-channel-container"></div>					</div>			 </div>').format(pageData.textDirLeft,AI,AK,pageData.textDirRight,AJ)).appendTo(AF);if(AP){var AG=F("#top-level-forum .channel-config-dialog .channel-list");var AH=AG.find(".main-channel-container").last();F("html, body").animate({scrollTop:AH.offset().top},"fast")}I.forum=true;Y=true;return AO}function AA(AH,AI,AJ,AM,AG,AL){var AK='<div class="'+(AM?"category-to-channel":"channel-to-category")+'"><a href="#">'+vBulletin.phrase.get((AM?"make_forum":"make_category"))+"</a></div>";var AN=AG.hasClass("main-channel-container")?F("> .channel-item-container > .sub-channel-container",AG):F("> .sub-channel-container",AG);var AF=F(('<div class="channel-item-container">					<div class="channel-item shadow" data-channel-id="{0}" data-parent-id="{4}">						<div class="channel-item-inner">							<div class="grip-icon grip-icon-item {1}"><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div><div>&uml;</div></div>							<div class="channel-title"><div title="Click text to edit title">{2}</div><input type="text" name="channeltitle" value="{2}" /></div>							<div class="close-button" title="'+vBulletin.phrase.get("remove_forum")+'">x</div>							<div class="toggle-button"><</div>							<div class="num-subchannels">'+AL+'</div>							<div class="add-subchannel-button {3}" title="'+vBulletin.phrase.get("add_subforum")+'"><a href="#">+</a></div>							'+AK+'							<div class="clear"></div>						</div>				 </div>				 <div class="sub-channel-container"></div>				</div>').format(AH,pageData.textDirLeft,AJ,pageData.textDirRight,AI)).hide().appendTo(AN);I.forum=true;Y=true;return AF}function q(){window.vBulletin.loadingIndicator.show();F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-widget-admin-template-list",dataType:"json",complete:function(){console.log("fetch-widget-admin-template-list complete. templatesLoaded="+T);if(T){window.vBulletin.loadingIndicator.hide()}F("body").css("cursor","auto");A();F(window).resize(A)},success:function(AH){console.log("fetch-widget-admin-template-list successful! result:");console.dir({result:AH});d=true;if(F.isArray(AH)){if(AH.length>0){var AI={},AM=0,AJ=[];AI.customized_copy={count:0,title:vBulletin.phrase.get("my_custom_modules")};F.each(AH,function(AO,AP){if(!AP.widgetid||Number(AP.widgetid)<1){return true}AM++;if(!AI[AP.category]){AI[AP.category]={count:1,title:AP.category_title}}else{AI[AP.category].count++}var AN=F("#edit-page-dropdown .module-list .module-icon-template").clone();AN.attr("data-widget-id",AP.widgetid).attr("data-title",F.trim(AP.title).toLowerCase()).data("canbemultiple",AP.canbemultiple).removeClass("module-icon-template").addClass(("module-item list-item category-{0}"+(AP.cloneable=="1"?" module-cloneable":"")).format(AP.category));F(".module-icon",AN).html(F("<img />").attr("src",pageData.baseurl+"/"+pageData.admincpdir+"/img/"+F.trim(AP.icon)).attr("height",60).attr("width",60).attr("alt",vBulletin.phrase.get("module_icon")));F(".module-title .main-title",AN).html(F.trim(AP.title));AN.appendTo("#edit-page-dropdown .module-list").removeClass("hide");if(AP.category=="customized_copy"){AJ.push(AP.widgetid)}});F(".canvas-layout-container .canvas-widget").filter(function(){var AN=F(this).attr("data-widget-id");return(F.inArray(AN,AJ)!=-1)}).find(".module-buttons .edit-button").hide();F('<div class="custom-module-manage-links">								<a href="#" class="edit">'+vBulletin.phrase.get("edit")+'</a> 								<a href="#" class="rename">'+vBulletin.phrase.get("rename")+'</a> 								<a href="#" class="delete">'+vBulletin.phrase.get("delete")+"</a>							</div>").appendTo("#add-modules .module-list .category-customized_copy");F("#add-modules").on("click",".custom-module-manage-links a",function(AQ){AQ.preventDefault();var AS=F(this).attr("class");var AP=F(this).closest(".canvas-widget");if(AS=="edit"){AP.find(".module-buttons .admin-only .edit-button").click()}else{if(AS=="rename"){AP.draggable("disable");var AO=F(this);AO.hide();var AR=F(".main-title",AP);var AN=AR.text();AR.html('<input type="text" class="titleinput textbox" autocomplete="off" style="-moz-user-select:text;width:100%;" value="'+AN+'"> <a href="#" class="save">'+vBulletin.phrase.get("save")+'</a> <a href="#" class="cancel">'+vBulletin.phrase.get("cancel")+"</a>");F("a.save",AR).on("click",function(AT){AT.preventDefault();if(F(".titleinput",AR).val()==""){openAlertDialog({title:vBulletin.phrase.get("rename_custom_module"),message:vBulletin.phrase.get("please_enter_new_module_title"),iconType:"warning",onAfterClose:function(){F(".titleinput",AR).focus()}})}F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/renameWidget",type:"POST",data:{widgetId:AP.attr("data-widget-id"),newtitle:F(".titleinput",AR).val()},dataType:"json",success:function(AU){F("body").css("cursor","auto");if(AU===true){AN=F(".titleinput",AR).val();AR.text(AN);AO.show()}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error",onAfterClose:function(){F("#config-dialog .action-buttons button").prop("disabled",false)}})}},error:function(AW,AV,AU){F("body").css("cursor","auto");openAlertDialog({title:vBulletin.phrase.get("rename_custom_module"),message:vBulletin.phrase.get("error_renaming_module_title"),iconType:"error",onAfterClose:function(){F(".titleinput",AR).focus()}})},complete:function(AV,AU){AP.draggable("enable")}})});F("a.cancel",AR).on("click",function(AT){AT.preventDefault();AR.text(AN);AO.show();AP.draggable("enable")})}else{if(AS=="delete"){alert("Deleting is not yet implemented")}}}});F('<div id="create-custom-module" class="non-module-item canvas-widget module-item list-item category-customized_copy hide">								<div class="widget-header">									<div class="module-icon"><a href="#" title="'+vBulletin.phrase.get("create_new_custom_module")+'"><img width="60" height="60" alt="Create New Custom Module" src="'+pageData.baseurl+'/admincp/img/module-icon-create-new.png"></a></div>									<div class="module-title left"><a href="#" title="'+vBulletin.phrase.get("create_new_custom_module")+'">'+vBulletin.phrase.get("create_new_custom_module")+'</a></div>									<div class="clear"></div>								</div>							</div>').prependTo("#edit-page-dropdown .module-list");F("#create-custom-module a").on("click",function(){F("#create-new-module-dialog").dialog({title:vBulletin.phrase.get("choose_base_module"),autoOpen:true,modal:true,resizable:false,closeOnEscape:true,showCloseButton:true,width:950,dialogClass:"dialog-container pagemap-dialog-container input-dialog",create:function(){F("#create-new-module-dialog .cancel-button").on("click",function(){F("#create-new-module-dialog").dialog("close")});$modulelist=F(".module-list-container").clone();F("#create-new-module-dialog .dialog-body").append($modulelist);F("#create-new-module-dialog #create-custom-module").remove();F("#create-new-module-dialog .module-item").not(".module-cloneable").remove();F("#create-new-module-dialog .categories .category").each(function(){var AN=F(this).attr("id").substr("category-".length);var AO=F("#create-new-module-dialog .module-item").filter(".category-"+AN).size();if(AN=="all"){F(this).text("All ({0})".format(F("#create-new-module-dialog .module-item").size()))}else{if(AO<1){F(this).hide()}else{F(this).text((AI[AN].title+" ({0})").format(AO))}}});F("#create-new-module-dialog .module-list").css("width","800px");F("#create-new-module-dialog .module-item").css("cursor","pointer");F("#create-new-module-dialog .module-item").on("click",function(){window.vBulletin.loadingIndicator.show();var AN=F(this).attr("data-widget-id");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/cloneWidget",data:({widgetId:AN}),type:"POST",dataType:"json",complete:function(){console.log("/ajax/api/widget/cloneWidget complete");F("body").css("cursor","auto")},success:function(AO){if(AO&&typeof AO.widget=="object"){console.log("/ajax/api/widget/cloneWidget successful");console.log(AO);F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-widget-admin-template-list",data:({widgetids:[AO.widget.widgetid]}),type:"POST",dataType:"json",success:function(AP){if(F.isArray(AP)&&AP.length==1){var AR=AP[0];console.log("/ajax/fetch-widget-admin-template-list successful");console.log(AR);++AI[AR.category].count;var AQ=F("#edit-page-dropdown .module-list .module-icon-template").clone();AQ.attr("data-widget-id",AR.widgetid).attr("data-title",F.trim(AR.title).toLowerCase()).data("canbemultiple",AR.canbemultiple).removeClass("module-icon-template").addClass(("module-item list-item category-{0}"+(AR.cloneable=="1"?" module-cloneable":"")).format(AR.category));F(".module-icon",AQ).html(F("<img />").attr("src",pageData.baseurl+"/"+pageData.admincpdir+"/img/"+F.trim(AR.icon)).attr("height",60).attr("width",60).attr("alt",vBulletin.phrase.get("module_icon")));F(".module-title .main-title",AQ).html(F.trim(AR.title));AQ.insertAfter("#add-modules #create-custom-module").removeClass("hide");AQ.draggable({connectToSortable:".canvas-layout-row > .canvas-widget-list:visible",helper:"clone",revert:"invalid",appendTo:"#add-modules .module-list-container",zIndex:2000,start:function(AT,AU){if(F(this).data("canbemultiple")=="0"&&F("#content .canvas-layout .canvas-widget[data-widget-id={0}]".format(F(this).attr("data-widget-id"))).length>0){openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("adding_multiple_modules_not_allowed",F(".main-title",this).html()),iconType:"warning"});return false}X=true},stop:function(AT,AU){X=false}}).disableSelection();var AS=F("#add-modules .module-item").filter(".category-customized_copy").not(".non-module-item").size();F("#add-modules #category-customized_copy").text((AI.customized_copy.title+" ({0})").format(AS));F("#add-modules #category-all").click();F("#add-modules #category-customized_copy").click();F('<div class="custom-module-manage-links">																		<a href="#" class="edit">'+vBulletin.phrase.get("edit")+'</a> 																		<a href="#" class="rename">'+vBulletin.phrase.get("rename")+'</a> 																		<a href="#" class="delete">'+vBulletin.phrase.get("delete")+"</a>																	</div>").appendTo(AQ);window.vBulletin.loadingIndicator.hide();AQ.css("background-color","#2E3741");AQ.effect("highlight",{color:"#FFFF00"},2000,function(){F(this).css("background-color","transparent")})}else{console.log("/ajax/fetch-widget-admin-template-list successful, but response was not an array");console.log(AP);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AR,AQ,AP){console.log("/ajax/fetch-widget-admin-template-list failed, error: "+AP);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_cloned_widget_template",AR.status),iconType:"error"})}});F("#create-new-module-dialog").dialog("close")}else{console.log("/ajax/api/widget/cloneWidget successful, but response was not an array");console.log(AO);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AQ,AP,AO){console.log("/ajax/api/widget/cloneWidget failed, error: "+AO);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_cloning_widget",AQ.status),iconType:"error"})}})})},close:function(){F("#create-new-module-dialog .dialog-body").html("");F("#create-new-module-dialog").dialog("destroy")},open:function(){var AN=function(){var AO=F("#create-new-module-dialog .list-item");var AP=Math.max(AO.outerWidth(true)*AO.filter(":visible").length,parseFloat(AO.parent().css("min-width"),10));AO.parent().width(AP)};AN();B[3]=F("#create-new-module-dialog .module-list-container");B[3].tinyscrollbar({sizethumb:14,axis:"x",update:function(){}});B[3].tinyscrollbar_update();F("#create-new-module-dialog .categories .category").on("click",function(AQ){AQ.stopPropagation();var AO=F(this).closest(".module-list-container");var AR=F(".module-item",AO);F(".category.selected",AO).removeClass("selected");F(this).addClass("selected");AR.hide();F(".empty-module",AO).hide();var AP=this.id;if(AP=="category-all"){AR.show();F(".non-module-item",AO).hide();AN();B[3].tinyscrollbar_update()}else{if(AP=="category-result"){F("#search-module-keyword").triggerHandler("keyup",[true])}else{F(".module-item.{0}".format(AP),AO).show();AN();B[3].tinyscrollbar_update()}}return false}).disableSelection();F("#create-new-module-dialog #category-all").click()}});return false});F(('<div class="category-arrow-left {0}" title="'+vBulletin.phrase.get("previous")+'">&lsaquo;</div>								<div class="scroller category {0}">									<div class="categories {0}">										<div id="category-all" class="category selected">'+vBulletin.phrase.get("all")+' ({1})</div>										<div id="category-result" class="category hide">'+vBulletin.phrase.get("search_results")+' (<span></span>)</div>									</div>								</div>								<div class="category-arrow-right {0}" title="'+vBulletin.phrase.get("next")+'">&rsaquo;</div>								<div class="clear"></div>').format(pageData.textDirLeft,AM)).insertBefore("#edit-page-dropdown .module-list-container .scroller");var AG=0;F.each(AI,function(AO,AP){var AN=F('<div id="category-{0}" class="category">{1} ({2})</div>'.format(AO,AP.title,AP.count)).insertBefore("#category-result");AG+=AN.outerWidth(true)});var AL=AG+F("#category-all").outerWidth(true);F(".categories").width(AL);if(F(".categories").width()<=F(".scroller.category").width()){F(".category-arrow-left, .category-arrow-right").css("visibility","hidden")}else{F(".category-arrow-right").css("visibility","visible")}S(0);B[0]=F("#add-modules .module-list-container");B[0].tinyscrollbar({sizethumb:14,axis:"x",update:function(){if(F("#add-modules .module-list-container").innerHeight()<F("#add-modules .panel-header-text").height()){F("#add-modules .panel-header-text").height(F("#add-modules .module-list-container").innerHeight())}}});F("#edit-page-dropdown .module-list .module-item").not(".non-module-item").draggable({connectToSortable:".canvas-layout-row > .canvas-widget-list:visible",helper:"clone",revert:"invalid",appendTo:"#add-modules .module-list-container",zIndex:2000,start:function(AN,AO){if(F(this).data("canbemultiple")=="0"&&F("#content .canvas-layout .canvas-widget[data-widget-id={0}]".format(F(this).attr("data-widget-id"))).length>0){openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("adding_multiple_modules_not_allowed",F(".main-title",this).html()),iconType:"warning"});return false}X=true},stop:function(AN,AO){X=false}}).disableSelection();var AF=false;F("#search-module-keyword").on("keyup",function(AN,AV){var AU=F("#add-modules");var AR=F("#category-result");var AO=F(".categories",AU);var AP=F(".scroller.category",AU);var AQ=false;F(".module-item",AU).hide();if(!AV){F(".category.selected",AU).removeClass("selected")}var AT=F.trim(this.value.toLowerCase());if(AT){F('.module-item[data-title*="{0}"]'.format(AT),AU).show();AR.removeClass("hide").addClass("selected")}else{F(".module-item",AU).show();F("#category-all").removeClass("hide").addClass("selected");AR.addClass("hide").removeClass("selected");AQ=true}var AW=F(".module-item:visible",AU).length;F("span",AR).text(AW);S(0);B[0].tinyscrollbar_update();if(AW==0){F(".empty-module",AU).show()}else{F(".empty-module",AU).hide()}if(AQ){AO.width(AL)}else{AO.width(AL+AR.outerWidth(true))}if(AO.width()<=AP.width()){F(".category-arrow-left, .category-arrow-right",AU).css("visibility","hidden");AP.scrollLeft(0)}else{if(AQ){F(".category-arrow-left",AU).css("visibility","hidden");F(".category-arrow-right",AU).css("visibility","visible");AP.scrollLeft(0)}else{F(".category-arrow-left",AU).css("visibility","visible");F(".category-arrow-right",AU).css("visibility","hidden");var AS=AP.get(0);AP.scrollLeft(AS.scrollWidth-AS.clientWidth)}}return true});F("#add-modules .categories .category").on("click",function(AP){AP.stopPropagation();if(F(this).hasClass("selected")){return false}var AN=F(this).closest(".module-list-container");var AQ=F(".module-item",AN);F(".category.selected",AN).removeClass("selected");F(this).addClass("selected");AQ.hide();F(".empty-module",AN).hide();var AO=this.id;if(AO=="category-all"){AQ.show();F(".non-module-item",AN).hide();S(0);B[0].tinyscrollbar_update()}else{if(AO=="category-result"){F("#search-module-keyword").triggerHandler("keyup",[true])}else{F(".module-item.{0}".format(AO),AN).show();S(0);B[0].tinyscrollbar_update()}}return false}).disableSelection();var AK;F(".category-arrow-left").on({mousedown:function(){F(".category-arrow-right").css("visibility","visible");AK=setInterval(function(){var AN=F(".scroller.category");AN.scrollLeft(AN.scrollLeft()-20);if(AN.scrollLeft()==0){F(".category-arrow-left").css("visibility","hidden");clearInterval(AK)}},50)},mouseup:function(){clearInterval(AK)}}).disableSelection();F(".category-arrow-right").on({mousedown:function(){F(".category-arrow-left").css("visibility","visible");AK=setInterval(function(){var AO=F(".scroller.category");AO.scrollLeft(AO.scrollLeft()+20);var AN=AO.get(0);if(AO.scrollLeft()==AN.scrollWidth-AN.clientWidth){F(".category-arrow-right").css("visibility","hidden");clearInterval(AK)}},50)},mouseup:function(){clearInterval(AK)}}).disableSelection()}else{F('<div class="empty-module">'+vBulletin.phrase.get("no_modules")+"</div>").appendTo("#edit-page-dropdown .module-list")}}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})}},error:function(AH,AG,AF){console.log("fetch-widget-admin-template-list failed! error:"+AF);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",AH.status),iconType:"error"})}})}function G(){window.vBulletin.loadingIndicator.show();F("body").css("cursor","wait");F("#edit-page-dropdown .template-list").empty();F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/pagetemplate/fetchPageTemplateList",dataType:"json",complete:function(){console.log("fetchPageTemplateList complete.");if(d){window.vBulletin.loadingIndicator.hide()}F("body").css("cursor","auto")},success:function(AF){console.log("fetchPageTemplateList successful! result:");console.dir({templates:AF});T=true;if(F.isArray(AF)&&AF.length>0){F.each(AF,function(AG,AH){F('<div class="template-item list-item {0}">									<input type="radio" id="pagetemplateid-{1}" name="pagetemplateid" value="{1}" data-thumbnail="{2}/{3}/img/template-icon-default.png"{4} />									<label class="label">{5}</label>								</div>'.format(pageData.textDirLeft,AH.pagetemplateid,pageData.baseurl,pageData.admincpdir,(!n&&F("#save-page-form #pagetemplateid-yes").val()==AH.pagetemplateid)?' checked="checked"':"",AH.title)).appendTo("#edit-page-dropdown .template-list").data({screenlayoutid:AH.screenlayoutid,widgetinstances:AH.widgetinstances})});F(".template-item",F("#edit-page-dropdown .template-list")).each(function(AG){F(this).attr("data-title",F(".label",F(this)).text().toLowerCase())});F("#search-template-keyword").on("keyup",function(AK){if(AK.keyCode==13){AK.preventDefault();return false}var AH=F("#select-template");var AL=F(".scroller",AH);var AJ=false;F(".template-item",AH).hide();var AG=F.trim(this.value.toLowerCase());if(AG){F('.template-item[data-title*="{0}"]'.format(AG),AH).show()}else{F(".template-item",AH).show();AJ=true}var AI=F(".template-item:visible",AH).length;S(2);B[2].tinyscrollbar_update();if(AI==0){F(".empty-template",AH).show()}else{F(".empty-template",AH).hide()}return true});F("#search-template-keyword").on("keydown",function(AG){if(AG.keyCode==13){AG.preventDefault();return false}});i=F("#edit-page-dropdown .template-list .template-item input[type=radio]").thumbnailRadioCheckbox({thumbnailClass:"template-border",preselect:function(AH,AG){if(AG.is(":checked")){return false}if(l||Y){openConfirmDialog({title:vBulletin.phrase.get("switch_template"),message:vBulletin.phrase.get("template_changes_will_be_lost"),iconType:"warning",onClickYes:function(){l=false;Y=false;e=true;i.thumbnailRadioCheckbox("check",AG,true)}});return false}e=true;return true},select:function(AK,AG){F(".canvas-layout").addClass("hide");var AI=AG.closest(".template-item").data("screenlayoutid");F(".canvas-layout[data-layout-id="+AI+"]").removeClass("hide");c();AD();F("#save-page-form #pagetemplateid-yes, #config_pagetemplateid").val(AG.val());if(e){F(".canvas-widget-list").empty();var AH=AG.closest(".template-item").data("widgetinstances");if(F.isArray(AH)&&AH.length>0){W=false;var AJ=[];F.each(AH,function(AL,AM){AJ.push({widgetid:AM.widgetid,widgetinstanceid:AM.widgetinstanceid})});H(AJ,true);b()}else{window.vBulletin.loadingIndicator.hide()}}F("body").removeClass("lnkNewPage").addClass("lnkEditPage");F("#save-page-form .new-page-template input").prop("disabled",true);F("#save-page-form .edit-page-template input").prop("disabled",false);e=true},unselect:function(){}});S(2);B[2]=F("#select-template .template-list-container");B[2].tinyscrollbar({sizethumb:14,axis:"x",update:function(){if(F("#select-template .template-list-container").innerHeight()<F("#select-template .panel-header-text").height()){F("#select-template .panel-header-text").height(F("#select-template .template-list-container").innerHeight())}}})}else{window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_templates"),iconType:"error"})}},error:function(AH,AG,AF){console.log("fetchPageTemplateList failed! error:"+AF);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_modules",AH.status),iconType:"error"})}})}function K(AF,AH,AG){F.ajax({url:vBulletin.getAjaxBaseurl()+"/uploader/set_logo",data:({filedataid:F("#header .site-logo img").attr("data-fileid"),styleselection:F("#header .site-logo img").attr("data-styleselection")}),type:"POST",dataType:"text",complete:function(){console.log("uploader/set_logo complete.");F("body").css("cursor","auto")},success:function(AI){console.log("saving site logo successful! result:"+AI);if(F.trim(AI)==="true"){F("#header .site-logo img").removeAttr("data-styleselection").removeAttr("data-fileid").attr("data-orig-src",F("#header .site-logo img").attr("src"));F("#main-navbar li").removeClass("disabled").find("a").removeClass("selected");F("#admin-navbar-strip-gutter").addClass("hide").find(".prompt-text").text("");F(document.body).removeClass("edit-mode lnkHeader").addClass("view-mode");F("#header .disable-overlay").hide();F("#main-navbar ul.secondary-nav").removeClass("disabled");if(typeof AF=="function"){AF()}}else{console.log("saving site logo failed!");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_site_logo"),iconType:"error"});if(typeof AH=="function"){AH()}}},error:function(AK,AJ,AI){console.log("saving site logo failed! error:"+AI);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_site_logo_code",AK.status),iconType:"error"});if(typeof AG=="function"){AG()}}})}function O(AF,AG){F.each(AF,function(AI,AH){var AJ=F(('<div class="sub-channel channel" data-channel-id="{0}" data-parent-id="{7}">					<div class="avatar {1}"></div>					<div class="title"><a href="{2}{3}">{4}</a></div>					<div class="info">						<span class="label">'+vBulletin.phrase.get("last_post")+':</span>						<span class="title">{5}</span>					</div>					<div class="clear"></div>').format(AH.nodeid,pageData.textDirLeft,pageData.baseurl,AH.url,AH.title,(AH.lastPostTitle?AH.lastPostTitle:"<em>"+vBulletin.phrase.get("none")+"</em>"),pageData.baseurl_core,AH.parentid)).appendTo(AG);O(AF[AI].subchannels,AJ.eq(0))})}function h(AG,AF){F.each(AG,function(AH,AJ){var AI=F.map(AJ.subchannels,function(AM,AL){return AL}).length;var AK=AA(AJ.nodeid,AJ.parentid,AJ.title,AJ.category,AF,AI);h(AJ.subchannels,AK)})}function P(){D.tabs("select",0);var AL=F("#add-modules").height();D.tabs("select",1);var AF=F("#change-layout").height();D.tabs("select",2);var AG=F("#select-template").height();F("#edit-page-dropdown .lnkSaveChanges").trigger("click");var AI=F("#save-page-form").height();D.tabs("select",0);var AK=Math.max(AL,AF,AG,AI);var AH=F("#edit-page-dropdown .panel-header-text");AH.each(function(){var AM=F(this);AM.css("min-height",AK-parseFloat(AM.css("margin-top"))-parseFloat(AM.css("margin-bottom"))-parseFloat(AM.css("padding-top"))-parseFloat(AM.css("padding-bottom")))});var AJ=F("#edit-page-dropdown .panel-main-content");AJ.each(function(){var AM=F(this);AM.css("min-height",AK-parseFloat(AM.css("margin-top"))-parseFloat(AM.css("margin-bottom"))-parseFloat(AM.css("padding-top"))-parseFloat(AM.css("padding-bottom")))})}function S(AF){var AG=F("#edit-page-dropdown #edit-content > .tabs > .tab:eq({0}) .list > .list-item".format(AF));AG.parent().width(Math.max(AG.outerWidth(true)*AG.filter(":visible").length),parseFloat(AG.parent().css("min-width")))}function AB(AF,AG){var AH=(AG&&AG.length>0)?F(".canvas-layout .canvas-widget").not(AG).find(".widget-content"):F(".canvas-layout .canvas-widget .widget-content");if(AF){AH.each(function(){if(F(this).is(":hidden")){F(this).closest(".canvas-widget").find(".widget-header .toggle-button").trigger("click",[true])}})}else{AH.each(function(){if(!F(this).is(":hidden")){F(this).closest(".canvas-widget").find(".widget-header .toggle-button").trigger("click",[true])}})}}function R(AG,AF){if(AF){if(AG.find(".widget-content").is(":hidden")){AG.find(".toggle-button").trigger("click",[true])}}else{if(!AG.find(".widget-content").is(":hidden")){AG.find(".toggle-button").trigger("click",[true])}}}function b(){if(!n){var AF=F(".canvas-layout:visible .canvas-widget.subchannel-widget");if(AF.length==1){AF.find(".close-button").hide()}else{AF.find(".close-button").show()}}}function M(AH,AF){var AG=AH.attr("data-widget-id");if(Q[AG]==null){window.vBulletin.loadingIndicator.show();F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/fetch-widget-template",data:({widgetid:AG}),type:"POST",dataType:"json",complete:function(){window.vBulletin.loadingIndicator.hide();F("body").css("cursor","auto")},success:function(AI){console.log("Fetching module template successful");var AK=F.trim(AI);if(AK){var AJ=F(AK.replace(/\<\s*script[^\>]*\>(.*?)\<\s*\/\s*script\>/g,""));AJ.attr("data-title",function(){var AL=F(".module-title",AJ).clone();AL.find(".hide-on-viewmode").children().unwrap();AL.find("*:hidden").remove();return F.trim(AL.text()).toLowerCase()});Q[AG]=AJ;if(typeof AF=="function"){AF(AJ.clone(true))}}},error:function(AK,AJ,AI){console.log("Fetching module template failed, error: "+AI);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_cloned_widget_template",AK.status),iconType:"error"})}})}else{if(typeof AF=="function"){AF(Q[AG].clone(true))}}}function N(AF,AG){F(".edit-mode .canvas-widget.youtube-widget .widget-content").css("visibility",AF);if(AG){AG.find(".widget-content").css("visibility",(AF=="hidden"?"visible":"hidden"))}}function y(){F(document).off("click",".canvas-widget.default-widget .edit-button").on("click",".canvas-widget.default-widget .edit-button",function(){F("body").css("cursor","wait");var AK=F(this).closest(".canvas-widget");var AI=AK.attr("data-widget-id");var AG=F("> .widget-header .module-title",AK);var AH;if(F("span.admin-only",AG).length>0){AH=F("span.admin-only",AG).text()}else{AH=F(".hide-on-viewmode",AG).length>0?F(".hide-on-viewmode",AG).text():AG.text()}var AJ=AK.data("widget-type")||"";F("#config-dialog .loader").show();F("#config-dialog .widget-name h1").html(AH);F("#config-dialog .dialog-content .widget-config-container").hide().empty().removeClass("error");F("#config-dialog").data("selected-module",AK);N("hidden");F("#config-dialog").dialog("open");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchConfigSchema",data:({widgetid:AI,widgetinstanceid:AK.attr("data-widget-instance-id")||"",pagetemplateid:F("#config_pagetemplateid").val()||F("#select-template input[type=radio]:checked").val()||"",configtype:"admin"}),type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(AZ){console.log("fetchConfigSchema successful! result:"+JSON.stringify(AZ));if(AZ){F("#config_widgetid").val(AZ.widgetid);F("#config_widgetinstanceid").val(AZ.widgetinstanceid);F("#config_pagetemplateid, #save-page-form #pagetemplateid-yes, #save-page-form #pagetemplateid-new").val(AZ.pagetemplateid);AK.attr("data-widget-instance-id",AZ.widgetinstanceid);if(!AZ.configs||AZ.configs.length==0){F(".widget-config-container").html(vBulletin.phrase.get("no_configurations_found")).addClass("notice");F("#btnSaveConfig").prop("disabled",true);F("#btnCloseConfig").focus()}else{var AV=0;var AS=F("#config-dialog .dialog-content .widget-config-container");F('<input type="hidden" name="data[widget_type]" />').addClass("widget-type").val(AJ).appendTo(AS);var AY=false,AX=false,AO=false,AW=false,AP;F.each(AZ.configs,function(Ac,Ab){var Ae;switch(Ab.type){case"ChannelSetup":F("#config-dialog .dialog-content .channel-config-dialog").css("display","block");return true;break;case"Text":Ae=F('<input type="text" name="data[{0}]" id="data[{0}]" />'.format(Ab.name)).addClass("textbox config-textbox").val(Ab.defaultvalue||"");break;case"LongText":Ae=F('<textarea name="data[{0}]" id="data[{0}]" rows="3" />'.format(Ab.name)).addClass("textbox config-textbox").val(Ab.defaultvalue||"");break;case"YesNo":var Aa={option_1:F('<input type="radio" value="1" name="data[{0}]" id="data[{0}_1]" />'.format(Ab.name)),label_1:F("<label />").attr({"for":Ab.name+"_1"}).text("Yes"),option_0:F('<input type="radio" value="0" name="data[{0}]" id="data[{0}_0]" />'.format(Ab.name)),label_0:F("<label />").attr({"for":Ab.name+"_0"}).text("No")};var Af=Aa["option_"+Ab.defaultvalue];if(Af){Af.prop("checked",true)}Ae=F("<div />").append(Aa.option_1,Aa.label_1,Aa.option_0,Aa.label_0);break;case"Select":Ae=F('<select name="data[{0}]" />'.format(Ab.name));var Ad;if(Ab.data!=""){for(Ad in Ab.data){if(Ab.defaultvalue==Ad){F("<option />").attr("value",Ad).attr("selected","selected").text(Ab.data[Ad]).appendTo(Ae)}else{F("<option />").attr("value",Ad).text(Ab.data[Ad]).appendTo(Ae)}}}break}$requiredMark=F("<div />").addClass("config-required-mark "+pageData.textDirLeft).append(function(){return(Ab.isRequired==1)?"*":"&nbsp;"});if(Ab.isEditable==0){if(Ab.type=="YesNo"){Ae.find("input").prop("disabled",false)}else{Ae.prop("disabled",false)}}AS.append(F("<div></div>").addClass(function(){return"clearfix config-row"+(((++AV)%2!=0)?" odd":"")}).append(F("<div></div>").addClass("config-label "+pageData.textDirLeft).addClass(Ab.name).html(Ab.label),$requiredMark,F("<div></div>").addClass("config-value "+pageData.textDirLeft).addClass(Ab.name).append(Ae)));if(Ab.name=="default_tab"){AY=true}if(Ab.name=="display_tabs"){AX=true}if(Ab.name=="tab_order"){AO=true}if(Ab.name=="axd"){AW=true}});var AL=null;var AU=function(){AP=AF(AK);var Ad=AK.attr("data-widget-default-tab"),Ab=F('select[name="data[default_tab]"]',AS),Ac;Ab.empty();for(var Aa in AP){if(AX){if(!F('input:checkbox[value="'+AP[Aa].selector+'"]',AQ).is(":checked")){continue}}else{if(!AP[Aa].displayed){continue}}Ac=F('<option value="'+AP[Aa].selector+'">'+AP[Aa].label+"</option>");if(AL&&AL==AP[Aa].selector){Ac.attr("selected","selected")}else{if(Ad==AP[Aa].selector){Ac.attr("selected","selected")}}Ab.append(Ac)}};var AR=function(){AP=AF(AK);var Ab=F(".config-value.tab_order",AS),Ac,Ad;Ab.empty().append("<ul>");for(var Aa in AP){if(AX){if(!F('input:checkbox[value="'+AP[Aa].selector+'"]',AQ).is(":checked")){continue}}else{if(!AP[Aa].displayed){continue}}Ac=F('<li id="'+AP[Aa].selector+'">'+AP[Aa].label+"</li>");F("ul",Ab).append(Ac);Ad=F('<input name="data[tab_order]['+AP[Aa].selector.substring(1)+']" value="'+Aa+'" type="hidden">');Ab.append(Ad)}F("ul",Ab).sortable({stop:function(){var Ae=F(this).sortable("toArray");Ab.find("input:hidden").remove();for(Aa in Ae){Ad=F('<input name="data[tab_order]['+Ae[Aa].substring(1)+']" value="'+Aa+'" type="hidden">');Ab.append(Ad)}}});F("ul",Ab).disableSelection()};if(AX){AP=AF(AK);var AQ=F(".config-value.display_tabs",AS),AT;for(var AN in AP){AT=F('<label><input type="checkbox" name="data[display_tabs][]" value="'+AP[AN].selector+'">'+AP[AN].label+"</label>");if(AP[AN].displayed){AT.find("input:checkbox").attr("checked","checked")}AQ.append(AT)}if(AY){F("input:checkbox",AQ).on("click",function(){AU();AR()})}}if(AO){AR();F('select[name="data[default_tab]"]',AS).change(function(){AL=F(this).val()})}if(AY){AU()}if(AW){var AM=F(".config-value.axd",AS);AM.append('<button class="axd-edit-button button secondary" data-location="'+AZ.widgetinstanceid+'">'+vBulletin.phrase.get("edit")+"</button>")}}}F("#config-dialog .dialog-content .widget-config-container").show();F("#config-dialog .loader").hide()},error:function(AN,AM,AL){console.log("fetchConfigSchema failed! error:"+AL);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_configuration",AH),iconType:"error",onAfterClose:function(){F("#config-dialog").dialog("close")}});F("#config-dialog .loader").hide()}});return false});function AF(AH){var AG=[];F("ul.widget-tabs-nav li a, .widget-header ul.ui-tabs-nav li a, .widget-tabs-nav ul.ui-tabs-nav li a",AH).each(function(){var AI=F(this),AJ;if(F(this).closest("li").hasClass("hide")){AJ=false}else{AJ=true}AG.push({selector:AI.attr("href"),label:AI.text(),displayed:AJ})});return AG}}function c(){F(".edit-mode .canvas-layout:visible > .canvas-widget-list").width("").each(function(){F(this).width(F(this).width())})}function AD(){if(F.browser.msie&&parseInt(F.browser.version,10)==8){var AF=F(".edit-mode .canvas-layout:visible > .canvas-widget-list");AF.each(function(){var AG=F(".canvas-widget",this),AM=F(this);var AH=AG.outerHeight(true)||50;var AI=AG.length*AG.outerHeight(true);var AL=AM.height()-AI;console.log("offset:",AL);if(AL>=0&&AL<AH){var AK=F(window);var AJ=AK.scrollTop();AM.height(AM.height()+(AH-AL));AK.scrollTop(AJ);return false}else{if((AL>AH&&AM.height()>parseInt(AM.css("min-height"),10))||AL<0){var AK=F(window);var AJ=AK.scrollTop();AM.height(AI+AH);AK.scrollTop(AJ);return false}}})}}function f(){window.console.log("Fetching page manager forums (initializeForumEditor)");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchPageManagerForums",complete:function(){F("#config-dialog .loader").hide();F("body").css("cursor","auto")},success:function(AF){window.console.log("Successfully fetched page manager forums (initializeForumEditor)");p=true;var AH=F("<div>").addClass("channel-list");F.each(AF,function(AJ,AL){var AK=F.map(AL.subchannels,function(AN,AM){return AM}).length;var AI=AE(AH,AL.nodeid,AL.parentid,AL.title,AL.category,false,AK);h(AL.subchannels,AI)});var AG=F("#top-level-forum .channel-config-dialog");AG.find(".channel-list").remove();r(AH);J(AH);AG.append(AH);F(document).on("mousedown",".main-channel-container > .channel-item-container > .channel-item .grip-icon",function(){F(this).closest(".main-channel-container").height(F(this).closest(".main-channel-container").height())});F(document).on("mousedown",".sub-channel-container > .channel-item-container > .channel-item .grip-icon",function(){F(this).closest(".sub-channel-container").height(F(this).closest(".sub-channel-container").height())});Y=false;Z()},error_phrase:"error_fetching_channels"});F(document).on("click keydown",".channel-config-dialog .add-channel-fieldset .add-button, .channel-config-dialog .add-channel-fieldset input",function(AF){if(((AF.type=="click"||AF.which!=13)&&this.type=="text")||(AF.type=="keydown"&&this.type=="button"&&AF.which!=13)){return true}var AI=(this.type=="text")?F(this):F(this).prev();var AG=F.trim(AI.val());if(AG&&AG!=AI.prop("defaultValue")){var AH=F("#top-level-forum .channel-config-dialog .channel-list");AE(AH,"","",AG,0,true,0);r(AH);Z();AI.val("");if(this.type=="button"){AI.focus()}}else{openAlertDialog({title:vBulletin.phrase.get("warning_gcpuser"),message:vBulletin.phrase.get("please_enter_channel_title"),iconType:"warning",onAfterClose:function(){AI.focus()}})}});F(document).on("click",".channel-config-dialog .main-channel-container .channel-item .channel-title div",function(){F(this).hide();var AF=F(this).next();AF.show();AF.select();AF.focus()});F(document).on("keydown blur",".channel-config-dialog .main-channel-container .channel-item .channel-title input",function(AF){if(AF.type=="focusout"||(AF.type=="keydown"&&AF.which==13)){if(!F.trim(this.value)&&AF.type=="focusout"){this.value=this.defaultValue}if(F.trim(this.value)){F(this).hide();F(this).prev().html(this.value);F(this).prev().show()}}});F(document).on("click",".channel-config-dialog .channel-item .category-to-channel a",function(){var AF=F(this).closest(".channel-item");AF.attr("data-switch-category",0);F(this).parent().removeClass("category-to-channel").addClass("channel-to-category");F(this).html(vBulletin.phrase.get("make_category"));return false});F(document).on("click",".channel-config-dialog .channel-item .channel-to-category a",function(){var AF=F(this).closest(".channel-item");AF.attr("data-switch-category",1);F(this).parent().removeClass("channel-to-category").addClass("category-to-channel");F(this).html(vBulletin.phrase.get("make_forum"));return false});F(document).on("click",".channel-config-dialog .channel-item .toggle-button",function(){v(F(this));return false});F(document).on("click",".channel-config-dialog .channel-item .add-subchannel-button a",function(){var AF=F(this).parent().siblings(".toggle-button");v(AF,true);var AH=F(this).closest(".channel-item-container");var AG=AA("","","New Channel",0,AH,0);J(AH);AG.slideDown(100,function(){var AI=AH.find(".channel-item-inner").first().find(".num-subchannels");AI.text(parseInt(AI.text())+1);F(".channel-title div",AG).click();F(".channel-title input",AG).get(0).scrollIntoView(false);Z()});return false});F(document).on("click",".channel-config-dialog .channel-list .channel-item .close-button",function(){var AF=F(this);var AG=F("> .sub-channel-container > .channel-item-container",AF.closest(".channel-item-container")).length>0;openConfirmDialog({title:vBulletin.phrase.get("remove_forum_q"),message:vBulletin.phrase.get("do_you_want_to_remove_forum",F(this).prev().text(),(AG)?" "+vBulletin.phrase.get("subchannels_will_be_deleted"):""),iconType:"warning",onClickYes:function(){var AJ=AF.closest(".channel-item-container");var AI=AJ.parent();var AH=AF.closest(".channel-item").attr("data-channel-id");F("body").css("cursor","wait");F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/delete",data:{nodeid:AH},type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(AK){console.log("Delete channel successful! result:"+JSON.stringify(AK));if(AK.errors){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AK.errors[0]),iconType:"error"})}else{AJ.remove();if(AI.hasClass("main-channel-container")){AI.slideUp("fast",function(){F(this).remove()})}}},error:function(AM,AL,AK){console.log("Delete channel failed! result:"+AK);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_deleting_page",AM.status),iconType:"error"})}})}})})}function o(AG){function AF(AI,AJ,AH){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+("/ajax/render/{0}_list").format(AI),data:{page:AJ},complete:function(){F("#config-dialog .loader").hide();F("body").css("cursor","auto")},success:function(AK){F(("#top-level-{0} .channel-config-dialog").format(AI)).html(AK);if(AH){vBulletin.pagination({context:("#top-level-{0} .channel-config-dialog").format(AI),onPageChanged:function(AL,AM){AF(AI,AL)}})}},error_phrase:"error_fetching_channels"})}AF(AG,1,true);F(document).on("click",".page_manager_table .channel_name div",function(){F(this).hide();var AH=F(this).next();AH.show();AH.select();AH.focus()});F(document).on("keydown blur",".page_manager_table .channel_name input",function(AJ){if(AJ.type=="focusout"||(AJ.type=="keydown"&&AJ.which==13)){if(!F.trim(this.value)&&AJ.type=="focusout"){this.value=this.defaultValue}var AI=F.trim(this.value);var AH=F(this);if(AI&&AH.prev().html()!=AI){F("body").css("cursor","wait");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/Content_Channel/update",data:{nodeid:AH.parents(".channel_row").data("nodeid"),data:{title:AI}},complete:function(){F("#config-dialog .loader").hide();F("body").css("cursor","auto")},success:function(AK){AH.hide();AH.prev().html(AI);AH.prev().show()},error_phrase:"error_saving_page"})}}});F(document).on("click",".page_manager_table .delete",function(){var AH=F(this);openConfirmDialog({title:vBulletin.phrase.get("remove_channel_q"),message:vBulletin.phrase.get("do_you_want_to_remove_channel",AH.parents(".channel_row").find(".channel_name_val").text()),iconType:"warning",onClickYes:function(){F("body").css("cursor","wait");vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/delete",data:{nodeid:AH.parents(".channel_row").data("nodeid")},complete:function(){F("body").css("cursor","auto")},success:function(AI){AH.parents(".channel_row").remove()}})}})})}var p=false;function L(){F("body").css("cursor","wait");C=F("#manage-page .tabs").tabs({show:function(AF,AG){if(AG.index==0&&!p){f()}if(AG.index!=0&&Y){openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("forum_changes_will_be_lost"),iconType:"warning",onClickYes:function(){Y=false}});return false}},select:function(AF,AG){}});C.tabs("select",0);E=F("#manage-pages").tabs({show:function(AF,AG){if((AG.index==1||AG.index==2)){o(F(AG.tab).data("top-level"))}}});E.tabs("select",0);F("#manage-page-dropdown .lnkSaveChanges").on("click",function(){console.log("Saving forum/channel data");var AF=F(this);if(AF.hasClass("disabled")){console.log("We're busy saving already. Try again later.");return }AF.addClass("disabled");vBulletin.loadingIndicator.show();F("body").css("cursor","wait");var AG=[];function AH(AK,AI,AJ){var AL=F("> .channel-item-container",AK);if(AL.length>0){AL.each(function(AN){var AM=F("> .channel-item",this);var AO=AM.attr("data-channel-id");var AP=AM.attr("data-parent-id");subchannelObj={nodeid:AO||"0",previousParentId:AP,title:F(".channel-title div",AM).html(),displayorder:AN+1,parentid:AJ||"0",subchannels:[]};if(AM.attr("data-switch-category")!=null){subchannelObj.switchCategory=AM.attr("data-switch-category")}AI.subchannels.push(subchannelObj);AH(AM.next(".sub-channel-container"),AI.subchannels[AN],AO)})}}if(I.forum){F(".channel-config-dialog .channel-list .main-channel-container").each(function(AK){var AJ=F("> .channel-item-container > .channel-item",this);var AL=AJ.attr("data-channel-id");var AM=AJ.attr("data-parent-id");var AI={nodeid:AL,previousParentId:AM,title:F(".channel-title div",AJ).html(),displayorder:AK+1,subchannels:[]};if(AJ.attr("data-switch-category")!=null){AI.switchCategory=AJ.attr("data-switch-category")}AH(AJ.next(".sub-channel-container"),AI,AL);AG.push(AI)});vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveForums",data:{data:JSON.stringify(AG)},complete:function(){F("body").css("cursor","auto");vBulletin.loadingIndicator.hide();AF.removeClass("disabled")},success:function(AI){console.log("Forum/channel changes successfully saved");if(AI&&AI.forums&&AI.forums.length>0){Y=false;I.forum=false;location.reload(true)}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_forums"),iconType:"error"});return false}},error_phrase:"error_saving_channels_code"})}else{console.log("No forum/channel changes to save");vBulletin.loadingIndicator.hide();F("body").css("cursor","auto");AF.removeClass("disabled")}});F(document).on("click","#manage-page-dropdown .lnkExitWithoutSaving",function(){if(Y){openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("do_you_want_to_exit_without_saving_page"),iconType:"warning",onClickYes:function(){location.reload(true)}})}else{location.reload(true)}})}function V(){F(document).on("focus click",".edit-mode .widget-content a, .edit-mode #channel-tabbar a, .edit-mode #btnSearch, .edit-mode #q",function(AL){this.blur();return false});if(!d){q()}if(!T){G()}else{i.thumbnailRadioCheckbox("check",F("#select-template .template-border.selected").next("input"),false);if(!n){F("#select-template .template-item input[value={0}]".format(F("#pagetemplateid-yes").val())).prev().trigger("click")}}B[1]=F("#change-layout .layout-list-container");B[1].tinyscrollbar({sizethumb:14,axis:"x",update:function(){if(F("#change-layout .layout-list-container").innerHeight()<F("#change-layout .panel-header-text").height()){F("#change-layout .panel-header-text").height(F("#change-layout .layout-list-container").innerHeight())}}});F("#config_pagetemplateid").val("");if(n){F("#save-page-form #pagetitle").val("");F("#save-page-form #pageurl").val("");F("#save-page-form #pagetemplateid").val("0");F("#save-page-form #pageid").val("0")}F("#edit-page-dropdown .lnkSaveChanges").on("click",function(){F("#edit-page-dropdown .tabs li").removeClass("ui-tabs-selected ui-state-active");F("#edit-page-dropdown .tabs .tab").addClass("ui-tabs-hide");F("#save-content").show();F("#save-page-form .edit-page-template").css("display","");F("#save-page-form .edit-page-template").prev("label").css("display","");if(F("body").hasClass("lnkNewPage")){F("#save-page-form .new-page-template input").prop("disabled",false);F("#save-page-form .edit-page-template input").prop("disabled",true)}else{if(!F("#pagetemplateid-yes").prop("checked")&&!F("#pagetemplateid-no").prop("checked")){F("#pagetemplateid-yes").prop("checked",true)}F("#save-page-form .edit-page-template input").prop("disabled",false);F("#save-page-form .new-page-template input").prop("disabled",true);if(n&&(!l&&!Y)){F("#save-page-form .edit-page-template").css("display","none");F("#save-page-form .edit-page-template").prev("label").css("display","none")}if(F("#pagetemplateid-yes").prop("checked")){F("#save-page-form #templatetitle").prop("disabled",false);F("#save-page-form #templatetitle-edit").prop("disabled",true)}else{F("#save-page-form #templatetitle").prop("disabled",true);F("#save-page-form #templatetitle-edit").prop("disabled",false)}}});F(document).on("click","#edit-page-dropdown .lnkExitWithoutSaving",function(){if(l||Y||e||(!n&&(F("#pagetitle").val()!=F("#pagetitle").prop("defaultValue")||F("#pageurl").val()!=F("#pageurl").prop("defaultValue")))||(n&&(F("#pagetitle").val()!=""||F("#pageurl").val()!=""))){openConfirmDialog({title:vBulletin.phrase.get("exit_without_saving_page"),message:vBulletin.phrase.get("do_you_want_to_exit_without_saving_page"),iconType:"warning",onClickYes:function(){location.reload(true)}})}else{location.reload(true)}});var AF=0;F(window).on("resize.canvas",function(){clearTimeout(AF);AF=setTimeout(c,200)});var AI=function(AL){return'<label class="hide-icon module-button-item"><input type="checkbox" title="{0}" data-toggle-title="{1}"{2} /></label>'.format(vBulletin.phrase.get("check_to_hide_module"),vBulletin.phrase.get("uncheck_to_unhide_module"),AL?' checked="checked"':"")};F(".canvas-widget.container-widget .canvas-widget:not(.dummy-widget)").each(function(){var AL=F(this).hasClass("hidden-widget");F(".module-buttons .admin-only",this).prepend(AI(AL));if(AL){F(".module-buttons .admin-only .hide-icon input",this).trigger("click").prop("checked",true)}});var AK=function(AN,AO,AQ){var AP=AO.item,AQ=AO.item.hasClass("module-item");var AL=F("> .canvas-widget.container-widget {0}".format(AQ?".module-item":".canvas-widget.container-widget"),this);if(AL.length>0){var AM=AL.closest(".canvas-widget.container-widget");if(AM.attr("data-widget-id")==AL.attr("data-widget-id")){if(AQ){AL.remove()}else{if(AO.sender){AO.sender.sortable("cancel")}else{F(this).sortable("cancel")}}AJ=true;openAlertDialog({title:vBulletin.phrase.get("move_not_allowed"),message:vBulletin.phrase.get("dropping_container_module_into_container_module_not_allowed"),iconType:"warning"});return true}return false}return false};var AH=function(AL){if(AL.parents(".canvas-widget.container-widget").length>0){if(F(".module-buttons .admin-only .hide-icon",AL).length==0){F(".module-buttons .admin-only",AL).prepend(AI())}}else{AL.removeClass("hidden-widget").find("> .widget-header .module-buttons .admin-only .hide-icon").remove()}};var AJ=false;F(".edit-mode .canvas-layout .canvas-widget-list").sortable({revert:true,tolerance:"pointer",connectWith:".edit-mode .canvas-layout:visible .canvas-widget-list",placeholder:"canvas-widget canvas-widget-highlight drag-highlight clear",create:function(){c();AD()},update:function(AL,AM){var AN=this;if(U){if(!AJ){M(AM.item,function(AO){AM.item.replaceWith(AO);AO.filter(":not(.container-widget)").find(".toggle-button").trigger("click",[true]);if(!AK.apply(AN,[AL,AM])){AH(AO);AO.addClass("shadow").find(".widget-tabs").andSelf().filter(".widget-tabs").tabs();b();AO.parents(".canvas-widget.container-widget").find(".canvas-widget.dummy-widget").remove();var AP=AO.parents(".canvas-widget.container-widget");if(AP.length==1){AP.find(".canvas-widget-highlight").remove();AP.find(".module-item").remove()}}})}}else{if(!AK.apply(AN,[AL,AM])){AH(AM.item);b()}}l=true},out:function(AL,AM){},sort:function(AL,AM){if(X){U=true}var AN=AM.placeholder.closest(".canvas-widget.container-widget");if(AN.length==1&&AN.find(".canvas-widget:last-child").hasClass("canvas-widget-highlight")){AM.placeholder.css({"margin-bottom":0,"margin-top":-3})}else{AM.placeholder.css({"margin-bottom":"","margin-top":""})}},start:function(AL,AM){N("hidden",AM.item)},over:function(AL,AM){},stop:function(AM,AN){AJ=false;AD();U=false;AN.item.height("auto");N("visible");F(".canvas-layout .canvas-widget-list .canvas-widget-highlight").remove();var AL=F(".canvas-layout > .canvas-layout-row .canvas-widget-list > .canvas-widget.container-widget");F(".canvas-layout > .canvas-layout-row .canvas-widget-list > .canvas-widget.container-widget").each(function(){var AO=F(".canvas-widget-list",this);if(AO.children().length==0){AO.append('<div class="canvas-widget dummy-widget"><span>{0}</span></div>'.format(vBulletin.phrase.get("you_can_also_drag_and_drop_modules_here")))}else{if(AO.find(".canvas-widget.dummy-widget").length>0&&AO.find(".canvas-widget:not(.dummy-widget,.canvas-widget-highlight)").length>0){AO.find(".canvas-widget.dummy-widget").remove()}}})},receive:function(AL,AM){if(AM.item.hasClass("module-item")){AK.apply(this,[AL,AM,true])}},handle:".move-icon",items:".canvas-widget"}).find(".canvas-widget .widget-header").disableSelection();F(document).on("click",".edit-mode .canvas-widget .close-button",function(){var AL=F(this);openConfirmDialog({title:vBulletin.phrase.get("remove_module_q"),message:vBulletin.phrase.get("do_you_want_to_remove_module",AL.closest(".widget-header").find(".module-title").text()),iconType:"warning",onClickYes:function(){var AN=AL.closest(".canvas-widget"),AM=AN.parents(".canvas-widget.container-widget");AN.remove();AD();b();l=true;if(AM.find(".canvas-widget").length==0){AM.find(".canvas-widget-list").append('<div class="canvas-widget dummy-widget"><span>{0}</span></div>'.format(vBulletin.phrase.get("you_can_also_drag_and_drop_modules_here")))}}})});F(document).on("click",".edit-mode .search-widget .edit-button",function(){N("hidden");AG(F(this).closest(".search-widget"));F("#search-config-dialog").dialog("open");return false});F(document).on("click","#save-page-form #btnOK",function(AS,AR){var AL=F("#edit-page-dropdown .lnkSaveChanges .label").text();if(!AR){if(!F.trim(F("#save-page-form #pagetitle").val())){openAlertDialog({title:AL,message:vBulletin.phrase.get("please_enter_page_name"),iconType:"warning",onAfterClose:function(){F("#save-page-form #pagetitle").focus()}});return false}if(F("body").hasClass("lnkEditPage")){var AQ=F("#save-page-form #pagetemplateid-yes");var AM=F("#save-page-form #pagetemplateid-no");if(!AQ.prop("checked")&&!AM.prop("checked")){openAlertDialog({title:AL,message:vBulletin.phrase.get("please_choose_overwrite_template_options"),iconType:"warning",onAfterClose:function(){F("#save-page-form #pagetemplateid-yes").focus()}});return false}else{if(AM.prop("checked")){var AN=F("#save-page-form #templatetitle-edit");var AV=F.trim(AN.val());if(!AV||AV==AN.prop("defaultValue")){openAlertDialog({title:AL,message:vBulletin.phrase.get("please_enter_new_template_name"),iconType:"warning",onAfterClose:function(){F("#save-page-form #templatetitle-edit").focus()}});return false}openConfirmDialog({title:AL,message:vBulletin.phrase.get("applying_new_template",F("#save-page-form #templatetitle-edit").val()),buttonLabel:{yesLabel:vBulletin.phrase.get("save_page"),noLabel:vBulletin.phrase.get("cancel")},iconType:"warning",onClickYes:function(){F("#save-page-form #btnOK").trigger("click",true)}});return false}else{if(AQ.prop("checked")){if(n&&(!l&&!Y)){F("#save-page-form #btnOK").trigger("click",true)}else{openConfirmDialog({title:AL,message:vBulletin.phrase.get("overwrite_template_continue"),buttonLabel:{yesLabel:vBulletin.phrase.get("save_page"),noLabel:vBulletin.phrase.get("cancel")},iconType:"warning",onClickYes:function(){F("#save-page-form #btnOK").trigger("click",true)}})}return false}}}}else{var AN=F("#save-page-form #templatetitle-new");var AV=F.trim(AN.val());if(!AV||AV==AN.prop("defaultValue")){openAlertDialog({title:AL,message:vBulletin.phrase.get("please_enter_new_template_name"),iconType:"warning",onAfterClose:function(){F("#save-page-form #templatetitle-new").focus()}});return false}}}var AU=F(".canvas-layout:visible");u=AU.attr("id");F("#save-page-form #screenlayoutid").val(AU.attr("data-layout-id"));function AO(AY){var AZ={widgetId:AY.attr("data-widget-id"),widgetInstanceId:(AY.attr("data-widget-instance-id")||"0")};if(AY.hasClass("container-widget")){var AW=[];var AX=[];F("div.canvas-widget-list > div.canvas-widget",AY).each(function(Aa){if(!F(this).hasClass("hidden-widget")){AX.push(F(this).attr("data-widget-instance-id"))}AW.push(AO(F(this)))});AZ.subModules=AW;AZ.displaySubModules=AX}return AZ}F('input[type=hidden][name*="displaysections"]',AU).clone().appendTo(F("#moduleData").empty());F("#"+u+" > .canvas-layout-row > div.canvas-widget-list").each(function(){var AW=[];var AX=a(this);F(this).children("div.canvas-widget").each(function(){AW.push(AO(F(this)))});F('#save-page-form input[name="displaysections['+AX+']"]').val(JSON.stringify(AW))});var AT={};var AP=F("#save-page-form").serializeArray();F.each(AP,function(AW,AX){AT[AX.name]=AX.value});F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/page/pageSave",data:{input:AT},type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(AW){console.log("savePage successful! result:"+JSON.stringify(AW));if(AW&&AW.url!=null){window.location.href=pageData.baseurl+AW.url}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get(AW.errors[0]),iconType:"error"})}},error:function(AY,AX,AW){console.log("saveChannelWidgetConfig failed! result:"+AW);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_page",AY.status),iconType:"error"})}})});F("#config-dialog").dialog({title:vBulletin.phrase.get("module_configuration"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,height:500,width:800,dialogClass:"dialog-container config-dialog-container input-dialog",open:function(){F("#config-dialog .loader").show();F("body").css("cursor","wait")},create:function(){F(document).on("submit",".sitebuilder-widget-form",function(){function AM(AQ){F("body").css("cursor","wait");F("#config-dialog .action-buttons button").prop("disabled",true);var AR=F("#config-dialog").data("selected-module");var AO=F(AQ).find("#config_widgetid");var AN=AR.hasClass("category-customized_copy");var AP=AN?AQ.action.replace(/saveAdminConfig/,"saveDefaultConfig"):AQ.action;F.ajax({url:AP,type:AQ.method,data:(F(AQ).serializeArray()),dataType:"json",success:function(AT){console.log("saveAdminConfig successful!");F("body").css("cursor","auto");if(AT&&AT.data){var AX=F("#config-dialog").data("selected-module");var AS=AT.data.title||AT.data.tagCloudTitle||AT.data.searchResultTitle;if(AS){AX.find(".main-title").text(AS)}switch(AT.data.widget_type){case"custom-html-widget":AX.find(".widget-content").html(AT.data.html);R(AX,true);break;case"video-widget":var AU=AT.data.embed_data;if(AU){var AY=AX.find(".widget-content .videocontainer");if(AY.length==0){AY=F("<div />").addClass("videocontainer").appendTo(AX.find(".widget-content"))}var AW={code:AU.code,provider:AU.provider,width:"100%",height:260};F.get(vBulletin.getAjaxBaseurl()+"/ajax/render/bbcode_video",AW,function(AZ){if(AZ){AY.empty().append(AZ);R(AX,true)}},"json");AX.find(".widget-content").find(".note").addClass("hide")}break}var AV=F('select[name="data[default_tab]"]',F(AQ));if(AV.length>0){AX.attr("data-widget-default-tab",AV.val())}}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error",onAfterClose:function(){F("#config-dialog .action-buttons button").prop("disabled",false)}});F("#config-dialog .loader").hide()}F("#config-dialog").dialog("close")},error:function(AU,AT,AS){console.log("saveAdminConfig failed! error:"+AS);F("body").css("cursor","auto");openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_configuration_module",F("#config-dialog .widget-name h1").text()),iconType:"error",onAfterClose:function(){F("#config-dialog .action-buttons button").prop("disabled",false)}});F("#config-dialog .loader").hide()}})}var AL=this;AM(AL);return false});F("#btnCloseConfig").on("click",function(){F(".channel-config-dialog .channel-list").empty();F("#config-dialog").dialog("close")})},close:function(){N("visible");F("#config-dialog .dialog-content .channel-config-dialog").css("display","none");F("#config-dialog .action-buttons button").prop("disabled",false)}});F("#pagetitle").on("keyup blur",function(AL){if(n){F("#pageurl").val(this.value.latinise().replace(/[^\w-]+/g,""))}return true});F("#save-page-form #pagetemplateid-yes").on("click",function(){F("#save-page-form .template-name").addClass("hide");F("#save-page-form #templatetitle").prop("disabled",false);F("#save-page-form #templatetitle-edit").prop("disabled",true)});F("#save-page-form #pagetemplateid-no").on("click",function(){F("#save-page-form .template-name").removeClass("hide");F("#save-page-form #templatetitle").prop("disabled",true);F("#save-page-form #templatetitle-edit").prop("disabled",false)});function AG(AL){if(typeof z.search_config_dialog=="undefined"){vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/dialog_search_config",success:function(AM){z.search_config_dialog=AM;F("body").append(AM);AG(AL)},error_phrase:"error_fetching_dialog"});return }if(AL){F("#search-config-dialog").data("search-widget",AL)}F("#search-config-dialog").dialog({title:vBulletin.phrase.get("edit_search_module"),autoOpen:true,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:800,dialogClass:"dialog-container search-config-dialog-container input-dialog",close:function(){N("visible")},open:function(){var AM=this;F("#customSearchDialog",AM).addClass("invisible");F("body").css("cursor","wait");setTimeout(function(){vBulletin.search=vBulletin.search||{};var AO=function(){x=new vBulletin.search.SearchControl("#customSearchDialog");m(x)};var AN=F("#search-config-dialog").data("search-widget");var AP={id:AN.attr("data-widget-id"),instanceid:AN.attr("data-widget-instance-id")};if(typeof vBulletin.search.SearchControl=="undefined"){F.getScript(vBulletin.getAjaxBaseurl()+"/js/sb_search.js?"+pageData.simpleversion,AO).error(function(AT,AS,AQ){var AR=(AQ&&AQ.message)?"{0}: {1}".format(vBulletin.phrase.get("error"),AQ.message):"HTTP {0}: {1}".format(AT.status,AT.statusText);F("#search-config-dialog").dialog("close");openAlertDialog({title:vBulletin.phrase.get("error"),message:"{0}<br /><br />({1})".format(vBulletin.phrase.get("error_loading_search_config_script"),AR),iconType:"error"})}).complete(function(){F("body").css("cursor","auto");F("#customSearchDialog",AM).removeClass("invisible")})}else{F("#customSearchDialog",AM).removeClass("invisible");AO()}},1);Y=false},create:function(){F("#btnSaveSearchConfig").on("click",function(){F("body").css("cursor","wait");var AN=F("#search-config-dialog").data("search-widget");var AQ={id:AN.attr("data-widget-id"),instanceid:AN.attr("data-widget-instance-id")};var AO={pageid:pageData.pageid,widgetid:AQ.id,widgetinstanceid:AQ.instanceid,pagetemplateid:F("#select-template input[type=radio]:checked").val(),searchJSON:{}};var AP=F("#searchTitle");if(AP.length>0&&F.trim(AP.val()).length>0){AO.searchTitle=F.trim(AP.val());AP.data("defaultValue",AO.searchTitle)}var AM=F("#resultsPerPage");if(AM.length>0&&F.trim(AM.val()).length>0){AO.resultsPerPage=F.trim(AM.val());AM.data("defaultValue",AO.resultsPerPage)}AO.searchJSON=x.load();F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveSearchWidgetConfig",data:{data:JSON.stringify(AO)},type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(AR){console.log("savesearchWidgetConfig successful! result:"+JSON.stringify(AR));if(AR&&AR.widgetinstanceid>0&&AR.searchJSON){AN.attr("data-widget-instance-id",AR.widgetinstanceid);AN.find(".main-title").text(AO.searchTitle);F("#config_widgetinstanceid").val(AR.widgetinstanceid);F("#config_pagetemplateid").val(AR.pagetemplateid);F("#pagetemplateid-new").val(AR.pagetemplateid);F("#search-config-dialog").dialog("close");R(AN,true);Y=true}else{openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_search_config"),iconType:"error"})}},error:function(AT,AS,AR){console.log("saveSearchWidgetConfig failed! result:"+AR);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_saving_search_config_code",AT.status),iconType:"error"})}})});F("#btnCancelSearchConfig").on("click",function(){function AM(){F("#search-config-dialog").dialog("close");x.set("{}");var AP=F("#search-config-dialog #searchTitle");AP.val(AP.data("defaultValue"));var AO=F("#search-config-dialog #resultsPerPage");AO.val(AO.data("defaultValue"))}if(Y){var AN=F(this);openConfirmDialog({title:vBulletin.phrase.get("cancel_edit"),message:vBulletin.phrase.get("do_you_want_to_cancel_editing_search_module"),iconType:"warning",onClickYes:AM})}else{AM()}})}})}F("#blog-category-dialog").dialog({title:vBulletin.phrase.get("edit_blog_categories"),autoOpen:false,modal:true,resizable:false,closeOnEscape:false,showCloseButton:false,width:800,dialogClass:"dialog-container blog-category-dialog-container input-dialog",close:function(){N("visible")},open:function(){var AL=this;Y=false},create:function(){F("#blog-category-dialog #btnSaveCategories").on("click",function(){F("body").css("cursor","wait");F("#blog-category-dialog dialog-content loader").show();var AL=F("#search-config-dialog").data("blog-category-widget");var AM={id:AL.attr("data-widget-id"),instanceid:AL.attr("data-widget-instance-id")};vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/saveBlogCategories",data:{},complete:function(){F("body").css("cursor","auto");F("#blog-category-dialog dialog-content loader").hide()},success:function(AN){F("#blog-category-dialog dialog-content widget-config-container").html(AN)},error_phrase:"error_saving_blog_categories"})});F("#blog-category-dialog #btnNewCategory").on("click",function(){});F("#blog-category-dialog #btnCloseCategories").on("click",function(){if(Y){var AL=F(this);openConfirmDialog({title:vBulletin.phrase.get("cancel_edit"),message:vBulletin.phrase.get("do_you_want_to_cancel_editing_blog_categories_module"),iconType:"warning",onClickYes:F("#blog-category-dialog").dialog("close")})}else{F("#blog-category-dialog").dialog("close")}})}})}function m(AF){var AH=F(this).closest(".canvas-widget");var AG=F("#search-config-dialog").data("search-widget");var AI={id:AG.attr("data-widget-id"),instanceid:AG.attr("data-widget-instance-id")};F.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/widget/fetchSearchConfig",data:({widgetid:AI.id,widgetinstanceid:AI.instanceid||"",pagetemplateid:F("#config_pagetemplateid").val()||F("#select-template input[type=radio]:checked").val()||"",configtype:"admin"}),type:"POST",dataType:"json",complete:function(){F("body").css("cursor","auto")},success:function(AJ){console.log("fetchConfig successful! result:"+JSON.stringify(AJ));if(AJ.searchTitle){var AL=F("#searchTitle");if(AL.length>0){AL.val(AJ.searchTitle)}}if(AJ.resultsPerPage){var AK=F("#resultsPerPage");if(AK.length>0){AK.val(AJ.resultsPerPage)}}AF.set(AJ.searchJSON||{},AJ.contentTypes||{},AJ.channels||{});F("#config-dialog .dialog-content .widget-config-container").show();F("#search-config-dialog .form_layout .form_row .field_column select").selectBox();F("#config-dialog .loader").hide()},error:function(AL,AK,AJ){console.log("fetchConfigSchema failed! error:"+AJ);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_retrieving_configuration",widgetName),iconType:"error",onAfterClose:function(){F("#config-dialog").dialog("close")}});F("#config-dialog .loader").hide()}})}t()})})(jQuery);