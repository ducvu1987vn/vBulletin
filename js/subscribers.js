window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["followers","unable_to_contact_server_please_try_again"]);(function(A){var B=[".subscriptions-widget"];if(!vBulletin.pageHasSelectors(B)){return false}A(document).ready(function(){var D="mostactive",C=A(".subscriptions-widget .subscribers-tab");C.off("click",".pagenav-controls .pagenav-form .arrow").on("click",".pagenav-controls .pagenav-form .arrow",function(J){var H=A(this);if(!H.hasClass("disabled")){J.preventDefault();var E=H.attr("href");var K=C.find(".subscribers-pagination");var G=parseInt(K.find(":input[name=subscribers-per-page]").val());var F=(K.find(":input[name=userid]").length>0)?parseInt(K.find(":input[name=userid]").val()):false;var I={follower:F,page:E,perpage:G};if(D){I.filter_sort=D}A.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/followersPagination",data:(I),dataType:"json",success:function(L){if(L.total>0&&L.template){C.find(".subscribersContent .followers .content").html(L.template)}if(L.pagenavTemplate){C.find(".conversation-toolbar .toolbar-pagenav").html(L.pagenavTemplate)}C.find(".subscribers-totalcount span").html(L.total)},error:function(){openAlertDialog({title:vBulletin.phrase.get("followers"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}})}});C.off("keypress",".pagenav-form input[name=page]").on("keypress",".pagenav-form input[name=page]",function(J){if(J.keyCode==13){J.preventDefault();var I=A(this);var H=parseInt(I.val());var E=I.closest("form.pagenav-form").find(".pagetotal");var F=0;if(E){F=parseInt(E.text(),10)}if((F>0)&&(H>F)){H=F}else{if(H<1){H=1}}if(typeof (parseInt(H,10))=="number"&&parseInt(H,10)==H){var M=C.find(".subscribers-pagination");var K=parseInt(M.find(":input[name=subscribers-per-page]").val());var G=(M.find(":input[name=userid]").length>0)?parseInt(M.find(":input[name=userid]").val()):false;var L={follower:G,page:H,perpage:K};if(D){L.filter_sort=D}A.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/followersPagination",data:(L),dataType:"json",success:function(N){console.log("followersPagination successful. response: "+JSON.stringify(N));if(N.total>0&&N.template){C.find(".subscribersContent .followers .content").html(N.template)}C.find(".subscribers-totalcount span").html(N.total);if(N.pagenavTemplate){C.find(".conversation-toolbar .toolbar-pagenav").html(N.pagenavTemplate)}},error:function(){openAlertDialog({title:vBulletin.phrase.get("followers"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}})}}});C.off("click",".subscribersContent .subscribers_sortBy").on("click",".subscribersContent .subscribers_sortBy",function(){var G="";var I=A(this);var J=I.parents(".subscribersContent").find(".subscribers-pagination");if(I.hasClass("sortAsc")){G="mostactive"}else{G="leastactive"}var H=parseInt(J.find(":input[name=subscribers-page]").val());var F=parseInt(J.find(":input[name=subscribers-per-page]").val());var E=(J.find(":input[name=userid]"))?parseInt(J.find(":input[name=userid]").val()):false;A.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/followers_pagination",data:({follower:E,page:H,perpage:F,filter_sort:G}),dataType:"json",success:function(K){console.log("followers_pagination successful. response: "+JSON.stringify(K));if(K.total>0&&K.template){I.parents(".followers").find(".content").html(K.template)}if(K.pagenavTemplate){C.find(".conversation-toolbar .toolbar-pagenav").html(K.pagenavTemplate)}if(G=="mostactive"){I.addClass("sortDesc");I.removeClass("sortAsc");D="mostactive"}else{if(G=="leastactive"){I.addClass("sortAsc");I.removeClass("sortDesc");D="leastactive"}}C.find(".subscribers-totalcount span").html(K.total);I.toggleClass("vb-icon-triangle-up-wide vb-icon-triangle-down-wide")},error:function(){openAlertDialog({title:vBulletin.phrase.get("followers"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}})})})})(jQuery);