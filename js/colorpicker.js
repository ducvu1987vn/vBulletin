(function(B){var A=function(){var u={},C,p=65,U,r='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_cancel"></div><div class="colorpicker_submit"></div></div>',d={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},l=function(v,x){var w=J(v);B(x).data("colorpicker").fields.eq(1).val(w.r).end().eq(2).val(w.g).end().eq(3).val(w.b).end()},V=function(v,w){B(w).data("colorpicker").fields.eq(4).val(v.h).end().eq(5).val(v.s).end().eq(6).val(v.b).end()},G=function(v,w){B(w).data("colorpicker").fields.eq(0).val(t(v)).end()},M=function(v,w){B(w).data("colorpicker").selector.css("backgroundColor","#"+t({h:v.h,s:100,b:100}));B(w).data("colorpicker").selectorIndic.css({left:parseInt(150*v.s/100,10),top:parseInt(150*(100-v.b)/100,10)})},i=function(v,w){B(w).data("colorpicker").hue.css("top",parseInt(150-150*v.h/360,10))},H=function(v,w){B(w).data("colorpicker").currentColor.css("backgroundColor","#"+t(v))},g=function(v,w){B(w).data("colorpicker").newColor.css("backgroundColor","#"+t(v))},O=function(v){var x=v.charCode||v.keyCode||-1;if((x>p&&x<=90)||x==32){return false}var w=B(this).parent().parent();if(w.data("colorpicker").livePreview===true){E.apply(this)}},E=function(w){var x=B(this).parent().parent(),v;if(this.parentNode.className.indexOf("_hex")>0){x.data("colorpicker").color=v=N(a(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){x.data("colorpicker").color=v=F({h:parseInt(x.data("colorpicker").fields.eq(4).val(),10),s:parseInt(x.data("colorpicker").fields.eq(5).val(),10),b:parseInt(x.data("colorpicker").fields.eq(6).val(),10)})}else{x.data("colorpicker").color=v=I(n({r:parseInt(x.data("colorpicker").fields.eq(1).val(),10),g:parseInt(x.data("colorpicker").fields.eq(2).val(),10),b:parseInt(x.data("colorpicker").fields.eq(3).val(),10)}))}}if(w){l(v,x.get(0));G(v,x.get(0));V(v,x.get(0))}M(v,x.get(0));i(v,x.get(0));g(v,x.get(0));x.data("colorpicker").onChange.apply(x,[v,t(v),J(v)])},P=function(v){var w=B(this).parent().parent();w.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},m=function(){p=this.parentNode.className.indexOf("_hex")>0?70:65;B(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");B(this).parent().addClass("colorpicker_focus")},k=function(v){var x=B(this).parent().find("input").focus();var w={el:B(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:v.pageY,field:x,val:parseInt(x.val(),10),preview:B(this).parent().parent().data("colorpicker").livePreview};B(document).bind("mouseup",w,T);B(document).bind("mousemove",w,o)},o=function(v){v.data.field.val(Math.max(0,Math.min(v.data.max,parseInt(v.data.val+v.pageY-v.data.y,10))));if(v.data.preview){E.apply(v.data.field.get(0),[true])}return false},T=function(v){E.apply(v.data.field.get(0),[true]);v.data.el.removeClass("colorpicker_slider").find("input").focus();B(document).unbind("mouseup",T);B(document).unbind("mousemove",o);return false},X=function(v){var w={cal:B(this).parent(),y:B(this).offset().top};w.preview=w.cal.data("colorpicker").livePreview;B(document).bind("mouseup",w,S);B(document).bind("mousemove",w,K)},K=function(v){E.apply(v.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(v.pageY-v.data.y))))/150,10)).get(0),[v.data.preview]);return false},S=function(v){l(v.data.cal.data("colorpicker").color,v.data.cal.get(0));G(v.data.cal.data("colorpicker").color,v.data.cal.get(0));B(document).unbind("mouseup",S);B(document).unbind("mousemove",K);return false},Y=function(v){var w={cal:B(this).parent(),pos:B(this).offset()};w.preview=w.cal.data("colorpicker").livePreview;B(document).bind("mouseup",w,c);B(document).bind("mousemove",w,R)},R=function(v){E.apply(v.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(v.pageY-v.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(v.pageX-v.data.pos.left))))/150,10)).get(0),[v.data.preview]);return false},c=function(v){l(v.data.cal.data("colorpicker").color,v.data.cal.get(0));G(v.data.cal.data("colorpicker").color,v.data.cal.get(0));B(document).unbind("mouseup",c);B(document).unbind("mousemove",R);return false},W=function(v){B(this).addClass("colorpicker_focus")},s=function(v){B(this).removeClass("colorpicker_focus")},L=function(v){B(this).addClass("colorpicker_focus")},Z=function(v){B(this).removeClass("colorpicker_focus")},Q=function(w){var x=B(this).parent();var v=x.data("colorpicker").color;x.data("colorpicker").origColor=v;H(v,x.get(0));x.data("colorpicker").onSubmit(v,t(v),J(v),x.data("colorpicker").el);B(x.data("colorpicker").el).ColorPickerHide()},f=function(v){var z=B("#"+B(this).data("colorpickerId"));z.data("colorpicker").onBeforeShow.apply(this,[z.get(0)]);var AA=B(this).offset();var y=b();var x=AA.top+this.offsetHeight;var w=AA.left;if(x+176>y.t+y.h){x-=this.offsetHeight+176}if(w+356>y.l+y.w){w-=356}z.css({left:w+"px",top:x+"px"});if(z.data("colorpicker").onShow.apply(this,[z.get(0)])!=false){z.show()}B(document).bind("mousedown",{cal:z},q);return false},q=function(v){if(!j(v.data.cal.get(0),v.target,v.data.cal.get(0))){if(v.data.cal.data("colorpicker").onHide.apply(this,[v.data.cal.get(0)])!=false){v.data.cal.hide()}B(document).unbind("mousedown",q)}},j=function(x,w,v){if(x==w){return true}if(x.contains){return x.contains(w)}if(x.compareDocumentPosition){return !!(x.compareDocumentPosition(w)&16)}var y=w.parentNode;while(y&&y!=v){if(y==x){return true}y=y.parentNode}return false},b=function(){var v=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(v?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(v?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(v?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(v?document.documentElement.clientHeight:document.body.clientHeight)}},F=function(v){return{h:Math.min(360,Math.max(0,v.h)),s:Math.min(100,Math.max(0,v.s)),b:Math.min(100,Math.max(0,v.b))}},n=function(v){return{r:Math.min(255,Math.max(0,v.r)),g:Math.min(255,Math.max(0,v.g)),b:Math.min(255,Math.max(0,v.b))}},a=function(x){var v=6-x.length;if(v>0){var y=[];for(var w=0;w<v;w++){y.push("0")}y.push(x);x=y.join("")}return x},D=function(v){var v=parseInt(((v.indexOf("#")>-1)?v.substring(1):v),16);return{r:v>>16,g:(v&65280)>>8,b:(v&255)}},N=function(v){return I(D(v))},I=function(x){var w={h:0,s:0,b:0};var y=Math.min(x.r,x.g,x.b);var v=Math.max(x.r,x.g,x.b);var z=v-y;w.b=v;if(v!=0){}w.s=v!=0?255*z/v:0;if(w.s!=0){if(x.r==v){w.h=(x.g-x.b)/z}else{if(x.g==v){w.h=2+(x.b-x.r)/z}else{w.h=4+(x.r-x.g)/z}}}else{w.h=-1}w.h*=60;if(w.h<0){w.h+=360}w.s*=100/255;w.b*=100/255;return w},J=function(w){var y={};var AC=Math.round(w.h);var AB=Math.round(w.s*255/100);var x=Math.round(w.b*255/100);if(AB==0){y.r=y.g=y.b=x}else{var AD=x;var AA=(255-AB)*x/255;var z=(AD-AA)*(AC%60)/60;if(AC==360){AC=0}if(AC<60){y.r=AD;y.b=AA;y.g=AA+z}else{if(AC<120){y.g=AD;y.b=AA;y.r=AD-z}else{if(AC<180){y.g=AD;y.r=AA;y.b=AA+z}else{if(AC<240){y.b=AD;y.r=AA;y.g=AD-z}else{if(AC<300){y.b=AD;y.g=AA;y.r=AA+z}else{if(AC<360){y.r=AD;y.g=AA;y.b=AD-z}else{y.r=0;y.g=0;y.b=0}}}}}}}return{r:Math.round(y.r),g:Math.round(y.g),b:Math.round(y.b)}},e=function(v){var w=[v.r.toString(16),v.g.toString(16),v.b.toString(16)];B.each(w,function(x,y){if(y.length==1){w[x]="0"+y}});return w.join("")},t=function(v){return e(J(v))},h=function(){var w=B(this).parent();var v=w.data("colorpicker").origColor;w.data("colorpicker").color=v;l(v,w.get(0));G(v,w.get(0));V(v,w.get(0));M(v,w.get(0));i(v,w.get(0));g(v,w.get(0));w.data("colorpicker").onChange.apply(w,[v,t(v),J(v)])};return{init:function(v){v=B.extend({},d,v||{});if(typeof v.color=="string"){if(v.color.indexOf("rgb(")!=-1){var w=v.color.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);v.color=I({r:parseInt(w[1]),g:parseInt(w[2]),b:parseInt(w[3])})}else{v.color=N(v.color)}}else{if(v.color.r!=undefined&&v.color.g!=undefined&&v.color.b!=undefined){v.color=I(v.color)}else{if(v.color.h!=undefined&&v.color.s!=undefined&&v.color.b!=undefined){v.color=F(v.color)}else{return this}}}return this.each(function(){if(!B(this).data("colorpickerId")){var x=B.extend({},v);x.origColor=v.color;var z="collorpicker_"+parseInt(Math.random()*1000);B(this).data("colorpickerId",z);var y=B(r).attr("id",z);if(x.flat){y.appendTo(this).show()}else{y.appendTo(document.body)}x.fields=y.find("input").bind("keyup",O).bind("change",E).bind("blur",P).bind("focus",m);y.find("span").bind("mousedown",k).end().find(">div.colorpicker_current_color").bind("click",h);x.selector=y.find("div.colorpicker_color").bind("mousedown",Y);x.selectorIndic=x.selector.find("div div");x.el=this;x.hue=y.find("div.colorpicker_hue div");y.find("div.colorpicker_hue").bind("mousedown",X);x.newColor=y.find("div.colorpicker_new_color");x.currentColor=y.find("div.colorpicker_current_color");y.data("colorpicker",x);y.find("div.colorpicker_submit").bind("mouseenter",W).bind("mouseleave",s).bind("click",Q);y.find("div.colorpicker_cancel").bind("mouseenter",L).bind("mouseleave",Z).bind("click",function(){var AA=B(this).parent();h.apply(this);B(AA.data("colorpicker").el).ColorPickerHide()});l(x.color,y.get(0));V(x.color,y.get(0));G(x.color,y.get(0));i(x.color,y.get(0));M(x.color,y.get(0));H(x.color,y.get(0));g(x.color,y.get(0));if(x.flat){y.css({position:"relative",display:"block"})}else{B(this).bind(x.eventName,f)}}})},showPicker:function(){return this.each(function(){if(B(this).data("colorpickerId")){f.apply(this)}})},hidePicker:function(){return this.each(function(){if(B(this).data("colorpickerId")){B("#"+B(this).data("colorpickerId")).hide()}})},setColor:function(v){if(typeof v=="string"){if(v.indexOf("rgb(")!=-1){var w=v.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);v=I({r:parseInt(w[1]),g:parseInt(w[2]),b:parseInt(w[3])})}else{v=N(v)}}else{if(v.r!=undefined&&v.g!=undefined&&v.b!=undefined){v=I(v)}else{if(v.h!=undefined&&v.s!=undefined&&v.b!=undefined){v=F(v)}else{return this}}}return this.each(function(){if(B(this).data("colorpickerId")){var x=B("#"+B(this).data("colorpickerId"));x.data("colorpicker").color=v;x.data("colorpicker").origColor=v;l(v,x.get(0));V(v,x.get(0));G(v,x.get(0));i(v,x.get(0));M(v,x.get(0));H(v,x.get(0));g(v,x.get(0))}})},getColor:function(){if(B(this).data("colorpickerId")){var w=B("#"+B(this).data("colorpickerId"));var v=w.data("colorpicker").color;var x=J(v);return{rgb:x,hex:e(x),hsb:v}}}}}();B.fn.extend({ColorPicker:A.init,ColorPickerHide:A.hidePicker,ColorPickerShow:A.showPicker,ColorPickerSetColor:A.setColor,ColorPickerGetColor:A.getColor})})(jQuery);