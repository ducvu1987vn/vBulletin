window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["saving"]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,["postminchars","commentminchars"]);var galleryData={mediaTypeFilter:false,currentMediaPage:1,currentGalleryPage:1,currentNodeId:0,currentUserId:0,profileMediaDetailContainer:false,currentDateFilter:"anytime"};(function(A){var B=["#profileMediaDetailContainer"];if(!vBulletin.pageHasSelectors(B)){return false}window.vBulletin.media=window.vBulletin.media||{};window.vBulletin.media.calculatePhotosPerPage=function(D){D=D||50;var C=A("#profileMediaDetailContainer").is(":visible");if(!C){A("#profileMediaDetailContainer").removeClass("hide")}var E=Math.floor(A("#profileMediaDetailContainer").width()/128);if(!C){A("#profileMediaDetailContainer").addClass("hide")}return(D%E==0||D<=E)?D:D-(D%E)};A(document).ready(function(){A(".profileMediaAlbumLink").off("click").on("click",loadAlbum);A(document).off("click","#mediaList .albumLink").on("click","#mediaList .albumLink",loadGallery);var C=false;A(".profile-media-createvideo, .profile-media-upload").off("click").on("click",function(G){var D=A(".content-entry-box.content-entry-box-Media .content-entry-box-tab").length==2?(A(this).hasClass("profile-media-createvideo")?1:0):0;if(!C){C=A(G.target).closest(".ui-widget-content").find(".profileMediaEditContainer");var F,E=A(".content-entry-box.content-entry-box-Media");A(".ui-tabs-nav > li",E).removeClass("ui-state-disabled");E.tabs({selected:D,select:function(J,K){var H=A(this),L=[],M=H.tabs("length");for(var I=0;I<M;I++){if(I!=K.index){L.push(I)}}A(window).off("error.editorInit").on("error.editorInit",function(){H.tabs("option","disabled",[]);A(this).off("error.editorInit");return true});console.log("disabling tabs..."+L);A(this).tabs("option","disabled",L)},show:function(I,J){var H=A(this);F=A(".content-entry-box.content-entry-box-Media").find(J.tab.hash).find('textarea[name="text"]').attr("id");if(!vBulletin.ckeditor.editorExists(F)){vBulletin.ckeditor.initEditor(F,{complete:function(K){console.log("enabling all tabs...");H.tabs("option","disabled",[]);A(window).off("error.editorInit")},error:function(K){A("#"+K).prop("disabled",false).removeClass("ckeditor-load-on-focus").off("focus");H.addClass("no-ckeditor")}})}vBulletin.hv.initHvForPostAction(A(J.panel))}});C.dialog({modal:true,autoOpen:false,width:800,title:vBulletin.phrase.get("profile_media"),resizable:false,closeOnEscape:false,showCloseButton:false,dialogClass:"dialog-container dialog-box edit-media-upload-dialog",open:function(H,I){if(!vBulletin.ckeditor.editorExists(F)){vBulletin.ckeditor.initEditor(F,{error:function(J){A("#"+J).prop("disabled",false).removeClass("ckeditor-load-on-focus").off("focus");A(".content-entry-box",C).addClass("no-ckeditor")}})}A(document).data("gallery-container",A(this).find(".gallery-editor"))},close:function(){A(document).data("gallery-container",null)}});vBulletin.upload.initializePhotoUpload(C)}C.dialog("open");A(".content-entry-box.content-entry-box-Media").tabs("select",D);A("#mediabtnCancel, #btnCancel, .btnCancel").off("click").on("click",function(H){C.dialog("close")})});A(".profile-media-backbtn").off("click").on("click",function(E){A("#profileMediaDetailContainer").addClass("hide");A("#mediaPreviousPage").closest(".pagenav-controls-container").removeClass("hide");A("#profileMediaContainer").removeClass("hide");A(".media-tab .profile-toolbar .toolset-left > li").addClass("hide").has(".profile-media-upload, .profile-media-createvideo").removeClass("hide");galleryData.currentDateFilter="anytime";A(".profile-toolbar .media-toolbar-filter").addClass("hide");var D={totalpages:Number(A("#mediaList").data("totalpages")),totalcount:Number(A("#mediaList").data("totalcount")),currentpage:galleryData.currentMediaPage};setPagination(D)});A("#mediaCurrentPage").off("change").on("change",goMediaPage);A("#mediaPreviousPage, #mediaNextPage").off("click").on("click",goMediaPage);galleryData.profileMediaDetailContainer=A("#profileMediaDetailContainer").clone();vBulletin.ckeditor.registerEvent("ckeditor-bare-mediagallery-edit","afterSave",function(E,D){loadMediaPage(galleryData.currentMediaPage)});vBulletin.ckeditor.registerEvent("ckeditor-bare-mediagallery-edit","afterCancel",function(E,D){loadMediaPage(galleryData.currentMediaPage)});vBulletin.ckeditor.registerEvent("ckeditor-bare-mediagallery","afterSave",function(G,F){A(".edit-media-upload-dialog .profileMediaEditContainer").dialog("close");var D=A("#mediaList"),H=Number(D.data("totalpages")),I=Number(D.data("totalcount")),E=(I%vBulletin.media.ALBUMS_PERPAGE)==0?H+1:H;loadMediaPage(E)});vBulletin.ckeditor.registerEvent("ckeditor-bare-mediavideo","afterSave",function(E,D){A(".edit-media-upload-dialog .profileMediaEditContainer").dialog("close").find(".videoattach-container").removeClass("has-video").find(".videoscontainer").empty();loadMediaPage(1)});vBulletin.ckeditor.registerEvent("ckeditor-bare-video-edit","afterSave",function(E,D){loadMediaPage(galleryData.currentMediaPage)});A(".media-toolbar-filter").off("click").on("click",function(D){A(".filter-wrapper",this).toggleClass("selected");A(".arrow .vb-icon",this).toggleClass("vb-icon-triangle-down-wide vb-icon-triangle-up-wide");A(D.target).closest(".conversation-toolbar-wrapper").find(".toolbar-filter-overlay").slideToggle("slow",function(){var E="media_filter";if(A(this).is(":visible")){A("body").off("click."+E).on("click."+E,function(H){if(A(H.target).closest(".toolbar-filter-overlay").length==0&&A(H.target).closest(".toolbar-filter").length==0){A("body").off("click."+E);A(".media-toolbar-filter").trigger("click")}});var G={};var F=vBulletin.isScrolledIntoView(this,G);if(!F){A("html,body").animate({scrollTop:"+="+Math.abs(G.bottom)},"fast")}}else{A("body").off("click."+E)}})});A("form.media-filter-overlay").trigger("reset");A(".media-filter-overlay input[type=radio]").off("change").on("change",function(F){galleryData.currentDateFilter=this.value;var E=fetchMediaFilter(A(F.target));var D=A(".media-tab");if(D.data("perpage")){E.perpage=D.data("perpage")}loadGalleryById(E,true,0,D.data("callbacks"))})})})(jQuery);doMediaFilters=function(A){$(".profMediaFilterRow").removeClass("filterSelected");$(A.target).addClass("filterSelected");if($(A.target).hasClass("profMediaFilterAllTypes")){galleryData.mediaTypeFilter=false}else{if($(A.target).hasClass("profMediaFilterGallery")){galleryData.mediaTypeFilter="gallery"}else{if($(A.target).hasClass("profMediaFilterVideo")){galleryData.mediaTypeFilter="video"}}}loadMediaPage(1)};loadMediaPage=function(A){$("body").css("cursor","wait");$.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/render/profile_media_content",data:({userid:vBulletin.media.MEDIA_USERID,pageno:A}),dataType:"json",success:function(B){if(B.errors){openAlertDialog({title:vBulletin.phrase.get("profile_media"),message:vBulletin.phrase.get(B.errors[0][0]),iconType:"error"})}else{$("#mediacontent").html(B);$("#profileMediaDetailContainer").empty();$("#mediacontent").removeClass("hide");$("#profileMediaContainer").removeClass("hide");$(".media-tab .profile-toolbar .toolset-left > li").addClass("hide").has(".profile-media-upload, .profile-media-createvideo").removeClass("hide");$("#mediaPreviousPage").closest("pagenav-controls").removeClass("hide");$("#profileMediaDetailContainer").addClass("hide");$("#profileMediaContainer").removeClass("hide");galleryData.currentMediaPage=A;var C={totalpages:Number($("#mediaList").data("totalpages")),totalcount:Number($("#mediaList").data("totalcount")),currentpage:A};setPagination(C);$(".gallery-submit-form .hiddendata").html("");if(!vBulletin.isScrolledIntoView($("#profileTabs .profile-tabs-nav"))){$("html,body").animate({scrollTop:$("#profileTabs .profile-tabs-nav").offset().top},"slow")}}},error:function(){openAlertDialog({title:vBulletin.phrase.get("edit_avatar"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})},complete:function(){$("body").css("cursor","auto")}})};goMediaPage=function(B){var A=B.target.id;if($("#profileMediaDetailContainer").is(":visible")){gotoGalleryPage(B);return false}if(A=="mediaCurrentPage"){var C=parseInt($("#mediaCurrentPage").val());if(C>0&&C<=parseInt($("#mediaPageCount").html())){loadMediaPage(C)}else{$("#mediaCurrentPage").val(galleryData.currentMediaPage)}}else{if(A=="mediaPreviousPage"){if(galleryData.currentMediaPage>1){loadMediaPage(galleryData.currentMediaPage-1)}else{$("#mediaPreviousPage").addClass("disabled")}}else{if(A=="mediaNextPage"){if(galleryData.currentMediaPage<parseInt($("#mediaPageCount").html())){loadMediaPage(galleryData.currentMediaPage+1)}else{$("#mediaNextPage").addClass("disabled")}}}}return false};gotoGalleryPage=function(C){if(!galleryData.currentNodeId&&!galleryData.currentUserId){return false}var A=C.target.id;if(A=="mediaCurrentPage"){targetPage=parseInt($("#mediaCurrentPage").val());if(targetPage>0&&targetPage<=parseInt($("#mediaPageCount").html())){var B={nodeid:galleryData.currentNodeId,userid:galleryData.currentUserId,pageno:targetPage,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:galleryData.currentDateFilter};loadGalleryById(B)}else{$("#mediaCurrentPage").val(galleryData.currentGalleryPage)}}else{if(A=="mediaPreviousPage"){if(galleryData.currentGalleryPage>1){var B={nodeid:galleryData.currentNodeId,userid:galleryData.currentUserId,pageno:galleryData.currentGalleryPage-1,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:galleryData.currentDateFilter};loadGalleryById(B)}else{$("#mediaPreviousPage ").addClass("disabled")}}else{if(A=="mediaNextPage"){if(galleryData.currentGalleryPage<parseInt($("#mediaPageCount").html())){var B={nodeid:galleryData.currentNodeId,userid:galleryData.currentUserId,pageno:galleryData.currentGalleryPage+1,perpage:vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE),datefilter:galleryData.currentDateFilter};loadGalleryById(B)}else{$("#mediaNextPage").addClass("disabled")}}}}return false};setPagination=function(A){var B=$(".media-tab .pagenav-controls-container")[(A.totalpages>1)?"removeClass":"addClass"]("hide");if(B.is(":visible")){$("#mediaPreviousPage")[(A.currentpage<=1)?"addClass":"removeClass"]("disabled");$("#mediaNextPage")[(A.currentpage>=A.totalpages)?"addClass":"removeClass"]("disabled");$("#mediaCurrentPage").val(A.currentpage);$("#mediaPageCount").text(A.totalpages)}};loadGalleryById=function(E,G,H,F){var C={nodeid:galleryData.currentNodeId,userid:galleryData.currentUserId,channelid:0,pageno:1,dateFilter:galleryData.currentDateFilter,albumid:0};E=$.extend({},C,E);if(!isNaN(E.nodeid)){$("body").css("cursor","wait");var D;if(E.nodeid==-1){D="profile_media_videolist"}else{D="profile_textphotodetail"}if($(".media-tab #profileMediaDetailContainer").length==0){$(".media-tab").append(galleryData.profileMediaDetailContainer)}$("#profileMediaContainer").closest(".tab").find("li.list-item-gallery").remove();var B=vBulletin.getAjaxBaseurl()+"/ajax/render/"+D;var A={nodeid:E.nodeid,userid:E.userid,channelid:E.channelid,pageno:E.pageno,albumid:E.albumid,viewMore:H};if(E.dateFilter){A.dateFilter=E.dateFilter}if(E.perpage){A.perpage=E.perpage}$.ajax({url:B,type:"GET",data:A,dataType:"json",success:function(I){if(I.errors){openAlertDialog({title:vBulletin.phrase.get("profile_media"),message:vBulletin.phrase.get(I.errors[0][0]),iconType:"error"});if(F&&typeof F.error=="function"){F.error()}}else{galleryData.currentNodeId=E.nodeid;galleryData.currentUserId=E.userid;galleryData.currentGalleryPage=E.pageno;if(H){$(".album-detail .photo-preview").append(I);$("#profileMediaDetailContainer .more-gallery")[(galleryData.currentGalleryPage<$(".album-detail").data("totalpages"))?"removeClass":"addClass"]("hide-imp")}else{$("#profileMediaDetailContainer").html("").append(I);$("#profileMediaDetailContainer .more-gallery").off("click").on("click",getMorePhotos);$("#profileMediaDetailContainer").addClass("list-item");$("#profileMediaDetailContainer").attr("data-nodeid",E.nodeid);$("#profileMediaContainer").addClass("hide");$(".media-tab .profile-toolbar .toolset-left > li").removeClass("hide").has(".profile-media-upload, .profile-media-createvideo").addClass("hide");$("#profileMediaDetailContainer").removeClass("hide");$("#mediaPreviousPage").closest(".pagenav-controls-container").addClass("hide");$("#profileMediaDetailContainer .profile-media-uploadphotos").click(loadPhotoUploader);if(E.perpage){$(".media-tab").data("perpage",E.perpage).data("callbacks",F)}}}if(E.nodeid==-1){var J={totalpages:Number($("#profileMediaDetailContainer .media-video-list").data("totalpages")),totalcount:Number($("#profileMediaDetailContainer .media-video-list").data("totalcount")),currentpage:galleryData.currentGalleryPage};setPagination(J)}if(!G){$("form.media-filter-overlay").trigger("reset")}$(".profile-toolbar .media-toolbar-filter").removeClass("hide");if(F&&typeof F.success=="function"){F.success()}},error:function(){openAlertDialog({title:vBulletin.phrase.get("profile_media"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"});if(F&&typeof F.error=="function"){F.error()}},complete:function(){$("body").css("cursor","auto");if(F&&typeof F.complete=="function"){F.complete()}}})}};loadPhotoUploader=function(C){$(document).data("gallery-container",$(this).closest(".album-detail"));var A=vBulletin.upload.getUploadedPhotosDlg(false);var B=A.data("nodeid");if(!B||isNaN(parseInt(B))){return }$.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/render/media_addphotos?nodeid="+B,dataType:"json",success:function(D){if(D.errors){openAlertDialog({title:vBulletin.phrase.get("profile_media"),message:vBulletin.phrase.get(D.errors[0][0]),iconType:"warning",onAfterClose:function(){A.dialog("close")}})}else{A.html(D);vBulletin.upload.initializePhotoUpload(A);A.find(".btnPhotoUploadSave").off("click").on("click",saveGalleryPhotos);A.find(".btnPhotoUploadCancel").off("click").on("click",function(E){A.dialog("close")});vBulletin.upload.relocateLastInRowClass(A.find(".photo-item-wrapper"));if($(".photo-display .photo-item-wrapper:not(.hide)",A).length>0){$(".custom-upload-button .label",A).text(vBulletin.phrase.get("upload_more"));$(".btnPhotoUploadSave",A).show()}else{$(".btnPhotoUploadSave",A).hide()}A.dialog("open");vBulletin.upload.adjustPhotoDialogForScrollbar(A)}},error:function(F,E,D){console.log("/ajax/render/media_addphotos failed, error: "+D);openAlertDialog({title:vBulletin.phrase.get("profile_media"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error",onAfterClose:function(){A.dialog("close")}})}})};loadAlbum=function(B){var A={nodeid:parseInt($(this).closest("li").attr("data-nodeid"),10),userid:0,pageno:1,datefilter:"anytime"};galleryData.currentDateFilter="anytime";loadGalleryById(A)};loadGallery=function(B){var A=fetchMediaFilter($(this));A.pageno=1;A.perpage=vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE);galleryData.currentDateFilter="anytime";loadGalleryById(A)};getMorePhotos=function(D){var C=$(".media-tab").data("perpage");var B=$(".media-tab").data("callbacks");var A=fetchMediaFilter($(this));A.pageno=galleryData.currentGalleryPage+1;if(C){A.perpage=C}loadGalleryById(A,false,1,B)};saveGalleryPhotos=function(D){var C=$(D.target).closest(".profile-media-photoupload-dialog"),A=$(D.target).closest("form");if(A.length>0){$(D.target).closest(".photo-display-container").find(".photo-item-wrapper:not(.hide)").each(function(E,G){var F=parseInt($(G).find(".filedataid").val());if(!isNaN(F)){A.append('<input type="hidden" name="filedataid[]" value="'+F+'"/>');$('<input type="hidden" name="title_'+F+'" />').val($(G).find("textarea").val()).appendTo(A)}});var B=$("button",A).prop("disabled",true);$.ajax({url:A.attr("data-action-submit"),data:A.serializeArray(),type:"post",success:function(E){if(E.errors){if(typeof (E.errors[0])=="undefined"){openAlertDialog({title:vBulletin.phrase.get("media"),message:vBulletin.phrase.get(E.errors),iconType:"error"})}else{openAlertDialog({title:vBulletin.phrase.get("media"),message:vBulletin.phrase.get(E.errors[0]),iconType:"error"})}}else{C.dialog("close");loadMediaPage(galleryData.currentMediaPage)}},error:function(){openAlertDialog({title:vBulletin.phrase.get("media"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error"})},complete:function(){B.prop("disabled",false)},})}else{C.dialog("close")}};fetchMediaFilter=function(A){var C;if($("#profileMediaContainer").is(":visible")){C=$("#profileMediaContainer")}else{if($("#profileMediaDetailContainer").is(":visible")){C=$("#profileMediaDetailContainer")}}var B={nodeid:parseInt(A.data("nodeid"),10)||parseInt(C.data("nodeid"),10),userid:parseInt(C.data("userid"),10),channelid:parseInt(C.data("channelid"),10),dateFilter:galleryData.currentDateFilter,albumid:parseInt(A.data("albumid"),10)};if(isNaN(B.channelid)){B.channelid=0}if(isNaN(B.nodeid)){B.nodeid=0}if(B.nodeid>0){B.userid=0}else{if(isNaN(B.userid)){B.userid=0}}if(isNaN(B.albumid)){B.albumid=0}return B};