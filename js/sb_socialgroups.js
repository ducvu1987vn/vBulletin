window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["contenttype_vbforum_socialgroup","error","invalid_page_specified","searchtype_social_groups"]);(function(A){var B=[".socialgroup-home-widget",".socialgroup-category-list-widget"];if(!vBulletin.pageHasSelectors(B)){return false}A(document).ready(function(){vBulletin.conversation=vBulletin.conversation||{};var S=A(".socialgroup-widget"),L=A(".activity-stream-widget"),E=A("#activity-stream-tab",L),F=A("#media-tab",L),J=A(".conversation-list",E),H,T,P,Q,C,D,I;if(L.length>0){function K(V){var W=(L.offset().top+(L.outerHeight()-parseFloat(L.css("border-bottom-width")))-V.height());return W}var G=L.find(".widget-tabs-nav .ui-tabs-nav > li"),N=G.filter(".ui-tabs-selected"),M=N.index(),U;if(M==-1){M=0;N=G.first()}U=N.find("> a").attr("href");G.removeClass("ui-state-disabled");var R=L.tabs({selected:M,select:function(X,Y){if(P){P.hideFilterOverlay()}var W=L.find(".widget-tabs-panel .ui-tabs-panel:visible");var V=W.find(".list-item-body-wrapper.edit-post .edit-conversation-container");if(V.length>0){openAlertDialog({title:vBulletin.phrase.get("edit_conversation"),message:vBulletin.phrase.get("you_have_a_pending_edit_unsaved"),iconType:"warning",onAfterClose:function(){vBulletin.animateScrollTop(V.closest(".list-item").offset().top,{duration:"slow"})}});return false}},show:function(X,Z){if(Z.tab.hash=="#activity-stream-tab"){if(!P){H=A(".conversation-toolbar-wrapper.scrolltofixed-floating",E);T=new vBulletin.scrollToFixed({element:H,limit:K(H)});P=new vBulletin.conversation.filter({context:E,autoCheck:A(".toolbar-filter-overlay input[type=radio][value=conversations_on]",L).is(":checked"),scrollToTop:L,onContentLoad:function(){T.updateLimit(K(H));vBulletin.truncatePostContent(J);vBulletin.conversation.processPostContent(J)}});if(U==Z.tab.hash){vBulletin.truncatePostContent(J);vBulletin.conversation.processPostContent(J);P.lastFilters={filters:P.getSelectedFilters(A(".toolbar-filter-overlay",E))}}}else{if(typeof P.lastFilters!="undefined"&&A(".conversation-empty:not(.hide)",Z.panel).length>0){delete P.lastFilters}}P.applyFilters(false,true)}else{if(Z.tab.hash=="#groups-tab"){function Y(d,a){if(a){return }var c=A(".sg-groups-list",Z.panel),b={perpage:c.data("perpage"),page:d||1};vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/socialgroup_nodes",data:b,error_phrase:"unable_to_contact_server_please_try_again",success:function(e){c.html(e);$sgPaginationFields=A(".sg-groups-pagination",c);W.updatePageInfo({totalpages:$sgPaginationFields.find("[name=totalpages]").val(),pagenumber:$sgPaginationFields.find("[name=pagenum]").val()},true)}})}if(P){P.toggleNewConversations(false)}var W=new vBulletin.pagination({context:Z.panel,onPageChanged:Y});Y();var V=A(".conversation-empty",Z.panel);if(V.length>0){if(U==Z.tab.hash&&!I){I=true;return false}V.addClass("hide")}}}}});L.off("click",".list-item-poll .view-more-ctrl").on("click",".list-item-poll .view-more-ctrl",function(W){var V=A(this).closest("form.poll");var X=V.find("ul.poll");A(this).addClass("hide");X.css("max-height","none").find("li.hide").slideDown(100,function(){V.find(".action-buttons").removeClass("hide").next(".view-less-ctrl").removeClass("hide");vBulletin.animateScrollTop(V.offset().top,{duration:"fast"})});return false});L.off("click",".list-item-poll .view-less-ctrl").on("click",".list-item-poll .view-less-ctrl",function(W){var V=A(this).closest("form.poll");vBulletin.conversation.limitVisiblePollOptionsInAPost(V,3);V.find("ul.poll").css("max-height","").find("li.hide").slideUp(100);return false});L.off("click",".post-controls .ipAddress").on("click",".post-controls .ipAddress",vBulletin.conversation.showIp);L.off("click",".post-controls .editCtrl").on("click",".post-controls .editCtrl",function(V){vBulletin.conversation.editPost.apply(this,[V,P])});L.off("click",".post-controls .voteCtrl").on("click",".post-controls .voteCtrl",function(V){if(A(V.target).closest(".bubble-flyout").length==1){vBulletin.conversation.showWhoVoted.apply(V.target,[V])}else{vBulletin.conversation.votePost.apply(this,[V])}return false});L.off("click",".post-controls .flagCtrl").on("click",".post-controls .flagCtrl",vBulletin.conversation.flagPost);L.off("click",".post-controls .commentCtrl").on("click",".post-controls .commentCtrl",vBulletin.conversation.toggleCommentBox);L.off("click",".comment-entry-box .post-comment-btn").on("click",".comment-entry-box .post-comment-btn",function(V){vBulletin.conversation.postComment.apply(this,[V,function(){P.updatePageNumber(1).applyFilters(false,true)}])});vBulletin.conversation.bindEditFormEventHandlers("all")}A(document).off("click",".add-sg").on("click",".add-sg",function(W){var V=A("div.socialgroup-widget").find(".conversation-toolbar-wrapper form.toolbar-filter-overlay :input[name=nodeid]").val()||pageData.channelid;A.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/content_channel/canAddChannel",data:{nodeid:V},type:"POST",dataType:"json",async:false,success:function(X){if(X.can===true){location.href=pageData.baseurl+"/sgadmin/create/settings"}else{if(X.exceeded>0){openAlertDialog({title:vBulletin.phrase.get("social_groups"),message:vBulletin.phrase.get("you_can_only_create_x_groups_delete",X.exceeded),iconType:"warning"})}else{openAlertDialog({title:vBulletin.phrase.get("social_groups"),message:vBulletin.phrase.get(X.error),iconType:"warning"})}}}})});A(document).off("click",".sgFilter").on("click",".sgFilter",function(X){$filterButton=A(this);var V=A.trim($filterButton.attr("data-type"));var W;if(V=="my"){W=1}else{W=0}var Y={};Y.my=W;Y.page=1;O(Y,$filterButton,true);$filterButton.closest("div.button-set").children().removeClass("selected");$filterButton.addClass("selected")});vBulletin.conversation.bindEditFormEventHandlers("all");A(".right-arrow",S).off("click").on("click",function(X){X.preventDefault();$arrow=A(this);if(!$arrow.hasClass("disabled")){var V=$arrow.closest(".groups-tab").find(".conversation-list .sg-groups-list .sg-groups-pagination"),W=parseInt(A("input[type=hidden][name=pagenum]",V).val(),10);A("input[type=hidden][name=pagenum]",V).val(W+1);O(false,$arrow,true)}});A(".left-arrow",S).off("click").on("click",function(Y){Y.preventDefault();var W=A(this);if(!W.hasClass("disabled")){var V=W.closest(".groups-tab").find(".conversation-list .sg-groups-list .sg-groups-pagination"),X=parseInt(A("input[type=hidden][name=pagenum]",V).val(),10);A("input[type=hidden][name=pagenum]",V).val(X-1);O(false,W,true)}});A(".pagenav-form .pagenav input[type=text][name=page]",S).off("keypress").on("keypress",function(Z){if(Z.which==13){Z.preventDefault();var Y=A(this);var V=Y.closest(".groups-tab").find(".conversation-list .sg-groups-list .sg-groups-pagination"),X=parseInt(A("input[type=hidden][name=totalpages]",V).val(),10),W=parseInt(Y.val(),10);if(!isNaN(X)&&!isNaN(W)&&(W<=X)){A("input[type=hidden][name=pagenum]",V).val(W);O(false,Y,true)}else{openAlertDialog({title:vBulletin.phrase.get("contenttype_vbforum_socialgroup"),message:vBulletin.phrase.get("invalid_page_specified"),iconType:"error"})}}});function O(a,V,Y){var e=V.closest(".groups-tab"),X=A(".conversation-list .sg-groups-list",e),c=A(".sg-groups-pagination",X);if(!a){a={}}var b=(!a.perpage)?A("input[type=hidden][name=per-page]",c).val():a.perpage;var d=(!a.page)?A("input[type=hidden][name=pagenum]",c).val():a.page;var Z=A("input[type=hidden][name=category]",c).val();if(Z){a.sgparent=Z}var f;if(a.my==undefined){var W=A(".conversation-toolbar .button-set .sgFilter",e).filter(function(g){return A(this).hasClass("selected")});f=(A(W).attr("data-type")=="all")?0:1}else{f=a.my}a.page=d;a.perpage=b;a.my=f;A.ajax({type:"post",url:vBulletin.getAjaxBaseurl()+"/ajax/render/socialgroup_nodes",data:a,dataType:"json",success:function(g){if(g.errors){openAlertDialog({title:vBulletin.phrase.get("contenttype_vbforum_socialgroup"),message:vBulletin.phrase.get(g.errors[0]),iconType:"error"})}else{X.html(g)}},fail:function(){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("unable_to_contact_server_please_try_again"),iconType:"error"})}}).done(function(){if(Y){var g={};A("input[type=hidden]",c).each(function(i,j){g[A(j).attr("name")]=parseInt(A(j).val(),10)});var h=A(".conversation-toolbar-wrapper .pagenav-controls .pagenav-form",e);A(".arrow",h).removeClass("disabled");A("input[type=text][name=page]",h).val(g.pagenum);A(".pagetotal",h).text(g.totalpages);if(!g.nextpage){A(".right-arrow",h).addClass("disabled")}if(!g.prevpage){A(".left-arrow",h).addClass("disabled")}}})}})})(jQuery);